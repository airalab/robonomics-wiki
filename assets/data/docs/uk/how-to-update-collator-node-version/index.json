{"hash":"f2a1ee146d28057ea7a76a3738787da612f8097c","data":{"doc":{"id":"f89093959a576a9b7409427c7703d301","title":"Як оновити версію вузла Robonomics Collator","description":"","contributors":["Leemo94"],"headings":[],"subtitles":[{"depth":2,"value":"","anchor":"#необхідні-команди"},{"depth":2,"value":"","anchor":"#зміна-бази-даних-ланцюжка-ретрансляції-kusama-без-встановленого-базового-шлху"}],"content":"\nРекомендується прочитати наступні статті перед читанням цього посту: [\"Як побудувати вузол Collator\"](/docs/how-to-build-collator-node) та [\"Як запустити Robonomics Collator\"](/docs/how-to-launch-the-robonomics-collator).\n\nУ цій статті наведені команди, необхідні для оновлення вузла Robonomics Collator (працюючого на Ubuntu), а також наведено приклад після цього.\n\n## **Необхідні команди**\n\n0. Перш ніж почати, рекомендується увійти як `root`, якщо ні, то рекомендується використовувати:\n\n<code-helper copy>\n\n```shell\nsudo su -\n```\n\n</code-helper>\n\n1. Зупиніть службу Robonomics:\n\n<code-helper copy>\n\n```shell\nsystemctl stop robonomics.service\n```\n\n</code-helper>\n\n2. Видаліть попередню версію Robonomics (переконайтеся, що ви знаходитесь у правильній директорії):\n\n<code-helper copy>\n\n```shell\nrm -f robonomics.X.X.X-ubuntu-x86_64.tar.gz\n```\n\n</code-helper>\n\n3. Отримайте [останню версію](https://github.com/airalab/robonomics/releases) Robonomics:\n\n<code-helper copy>\n\n```shell\nwget https://github.com/airalab/robonomics/releases/vX.X.X/.....\n```\n</code-helper>\n\n\n4. Розпакуйте файл:\n\n<code-helper copy>\n\n```shell\ntar -xf robonomics-X.X.X-x86_64-unknown-linux.gnu.tar.gz\n```\n</code-helper>\n\n5. Перемістіть файл:\n\n<code-helper copy>\n\n```shell\nmv robonomics /usr/local/bin/\n```\n</code-helper>\n\n<robo-wiki-note type=\"note\">\n\nВам потрібно перемістити цей файл у правильну директорію, в якій ви встановили вузол Robonomics)\n\n</robo-wiki-note>\n\n6. Запустіть Robonomics:\n\n<code-helper copy>\n\n```shell\nsystemctl start robonomics.service\n```\n</code-helper>\n\nПриклад оновлення вузла Collator до Robonomics v1.8.4:\n\n<code-helper>\n\n```shell\nsudo su -\ncd /home/admin\nsystemctl stop robonomics.service\nrm -f robonomics-1.7.3-x86_64-unknown-linux-gnu.tar.gz\nwget https://github.com/airalab/robonomics/releases/download/v1.8.4/robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\ntar -xf robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\nmv robonomics /usr/local/bin/\nsystemctl start robonomics.service\n\n```\n</code-helper>\n\n## **Зміна бази даних ланцюжка ретрансляції Kusama без встановленого базового шлху**\n\nІноді певні знімки ланцюжка ретрансляції Kusama призводять до помилок вашого вузла. Це часто призводить до зупинки роботи вузла. Приклад помилки, спричиненої пошкодженою базою даних ланцюжка ретрансляції:\n\n<code-helper>\n\n```shell\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] GRANDPA voter error: could not complete a round on disk: Database\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] Essential task `grandpa-voter` failed. Shutting down service.\nDec 08 19:14:32 ns3159483 robonomics[1019836]: Error: Service(Other(\"Essential task failed.\"))\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\nec 08 19:14:33 ns3159483 robonomics[1022922]: Error: Service(Client(Backend(\"Invalid argument: Column families not opened: col12, col11, col10, col9, col8, col7, col6, col5, col4, col3, col2, col1, col0\")))\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\n```\n</code-helper>\n\nЩоб виправити цю помилку, вам слід видалити існуючу базу даних ланцюжка ретрансляції Kusama (найімовірніше, RocksDb) та замінити її іншою базою даних, такою як ParityDb. Виконайте наступні команди:\n\n1. Знайдіть директорію вузла Robonomics та перевірте файли:\n\n<code-helper>\n\n```shell\ncd /home/robonomics/\nls -a\n```\n</code-helper>\n\n2. Підтвердіть, що ви бачите директорію polkadot, а потім перейдіть до директорії chains:\n\n<code-helper>\n\n```shell\ncd /polkadot/chains/\nls -a\n```\n</code-helper>\n\n3. Видаліть каталог `ksmcc3`:\n\n<code-helper copy>\n\n```shell\nrm -r ksmcc3\n```\n</code-helper>\n\n4. Створіть нову директорію `ksmcc3`.\n\n<code-helper>\n\n```shell\nmkdir ksmcc3\nchown -R robonomics:robonomics ksmcc3\ncd ksmcc3\n```\n\n</code-helper>\n\n5. Тепер вам потрібно завантажити новий знімок. У цьому прикладі використовується сильно обрізаний знімок ланцюжка ретрансляції, але ви можете замінити його на будь-який зімок, який вам подобається.\n\n<code-helper copy>\n\n```shell\nwget wget https://snaps.sik.rocks/ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n6. Поки знімок завантажується, відкрийте нову сесію та відредагуйте свій файл служби:\n\n\n<code-helper copy>\n\n```shell\nsudo nano /etc/systemd/system/robonomics.service\n```\n\n</code-helper>\n\nЗмініть рядки в файлі служби, які стосуються бази даних та обрізки:\n\n<code-helper copy>\n\n```shell\n  --database=paritydb \\\n  --state-pruning=100 \\\n  --blocks-pruning=100 \\\n  --execution=Wasm\n```\n\n</code-helper>\n\n  \nВикористовуйте `Ctrl + S`, а потім `Ctrl + X`, щоб зберегти та вийти з файлу служби.\n\n7. Тепер вам потрібно перезавантажити свій демон.\n\n<code-helper copy>\n\n```shell\nsystemctl daemon-reload\n```\n</code-helper>\n\n\n8. До цього часу, у вашій іншій сесії, сподіваюся, що нова база даних завантажена, тому розпакуйте файл:\n\n<code-helper copy>\n\n```shell\ntar -xvzf ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n9. Після завершення розпакування виконайте наступне:\n\n<code-helper copy>\n\n\n```shell\nchown -R robonomics:robonomics paritydb\n```\n\n</code-helper>\n\n10. Тепер ви можете запустити службу, слідкувати за помилками та перевірити, чи вона підключена як до ланцюжка ретрансляції, так і до паралельного ланцюжка:\n\n\n<code-helper copy>\n\n\n```shell\nsystemctl start robonomics && journalctl -fu robonomics\n```\n</code-helper>","tools":[],"fileInfo":{"path":"uk/how-to-update-collator-node-version.md","name":"how-to-update-collator-node-version"}}},"context":{}}