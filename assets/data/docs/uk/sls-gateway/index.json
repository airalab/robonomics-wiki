{"hash":"32a98c3a662b1063bc2bbf27afd4027f3b4cedb2","data":{"doc":{"id":"0491b208b28ab88f02fe261d308c8942","title":"Robonomics SLS Шлюз","description":"","contributors":["LoSk-p","Fingerling42","nakata5321"],"headings":[],"subtitles":[{"depth":2,"value":"Прошивка","anchor":"#прошивка"},{"depth":3,"value":"Усунення неполадок","anchor":"#усунення-неполадок"},{"depth":2,"value":"Конфігурація","anchor":"#конфігурація"},{"depth":2,"value":"Парування SLS з MQTT","anchor":"#парування-sls-з-mqtt"},{"depth":2,"value":"Підключення пристроїв","anchor":"#підключення-пристроїв"}],"content":"\n**У цій статті ви налаштуєте Robonomics SLS Шлюз. Ви встановите необхідне програмне забезпечення для шлюзу, налаштуєте його та підключите його до Home Assistant.**\n\n<robo-wiki-picture src=\"home-assistant/sls_gateway.png\" />\n\n## Прошивка\n\nСпочатку вам потрібно встановити прошивку мікроконтролера шлюзу. Підготуйте шлюз, встановивши перемикачі `1` та `3` в нижній частині SLS Шлюзу в положення `ON`, інші повинні бути `OFF`.\n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-13.gif\" />\n\nПідключіть шлюз до Raspberry Pi за допомогою порту USB type-C на шлюзі.\n\n<robo-wiki-picture src=\"home-assistant/sls-rpi.gif\" />\n\nКлонуйте репозиторій з прошивкою на Raspberry Pi:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\ngit clone https://github.com/airalab/robonomics-hass-utils.git\n```\n\n</code-helper>\n\nПерейдіть до `robonomics-hass-utils/esp_firmware/linux`. Щоб прошити SLS шлюз, вам потрібно запустити скрипти `Clear` та `Flash_16mb`.\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\ncd robonomics-hass-utils/esp_firmware/linux\nsudo chmod +x Clear.sh\nsudo chmod +x Flash_16mb.sh\n./Clear.sh\n./Flash_16mb.sh\n```\n\n</code-helper>\n\n### Усунення неполадок\n\nЯкщо у вас виникають проблеми з оновленням прошивки шлюзу, вам потрібно виконати додаткові кроки:\n\n1. Переконайтеся, що встановлено модуль pySerial:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\npip install pyserial\n```\n</code-helper>\n\n2. Надайте своєму користувачеві права доступу до USB-порту та перезавантажте комп'ютер:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\nsudo usermod -a -G dialout $USER\nsudo reboot\n```\n</code-helper>\n\n3. У деяких випадках необхідно змінити налаштування пропускної здатності в скрипті для оновлення прошивки. Відкрийте скрипт `Flash_16mb.sh` за допомогою редактора `nano` та змініть параметр baud з `921600` на менше значення (наприклад, `115200`).\n\n## Конфігурація\n\n1. Відключіть SLS Шлюз від комп'ютера. Встановіть перемикачі на задній панелі шлюзу в правильне положення. Перемикачі `5` (RX Zigbee до ESP) та `6` (TX Zigbee до ESP) повинні бути в положенні `ON`, інші повинні бути `OFF`. \n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-56.gif\" />\n\n2. Підключіть кабель живлення типу C. Індикаторне світло в центрі повинно загорітися зеленим.\n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-connect.gif\" />\n\n3. При першому запуску шлюз буде починати роздавати Wi-Fi з SSID `zgw****`. Підключіться до цієї мережі. Майте на увазі, що сигнал може бути досить слабким, тому краще тримати SLS шлюз ближче до комп'ютера. \n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-wifi.gif\" />\n\n4. Якщо підключення вдале, відкриється веб-інтерфейс (або ви можете знайти його за адресою 192.168.1.1). \n\n5. Ви побачите сторінку `Wi-Fi Settings`. Виберіть свою Wi-Fi та введіть пароль. Натисніть кнопку `Apply`. Шлюз перезавантажиться та підключиться до вашої Wi-Fi мережі. \n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmSht6roENzrV6oqsQ1a5gp6GVCz54EDZdPAP8XVh9SCwH', type:'mp4'}]\" />\n\n6. Знайдіть локальну IP-адресу SLS шлюзу для доступу до веб-інтерфейсу. Щоб знайти його, ви можете використовувати [мобільний додаток Fing](https://www.fing.com/products) або [інструмент командного рядка nmap](https://vitux.com/find-devices-connected-to-your-network-with-nmap/). Ім'я шлюзу повинно виглядати так: `zgw****`. Відкрийте веб-інтерфейс шлюзу, вставивши IP-адресу шлюзу в браузер.\n\n7. Перейдіть до `Setting` -> `Hardware` та переконайтеся, що налаштування виглядають так, як на зображенні. Виправте налаштування за потреби та натисніть кнопку `Save`:\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmeSksMxU9xkvvK7f81WDAYULiMFokK7P7KDVYEjv2MHjn', type:'mp4'}]\" />\n\nТаблиця з необхідними значеннями:\n\n| Field                    | Value              |\n|--------------------------|:-------------------|\n| Zigbee module            | TI                 |\n| Zigbee UART RX           | 22                 |\n| Zigbee UART TX           | 23                 |\n| Zigbee RST Pin           | 18                 |\n| Zigbee BSL Pin           | 19                 |\n| Service Button Pin       | 33 (pullUP - true) |\n| Number addressable leds  | 0                  |\n| Led Red (or addr)        | 21                 |\n| Led Green                | 5                  |\n| Led Blue                 | 27                 |\n| I2C SDA                  | 255                |\n| I2C SCL                  | 255                |\n\n8. Потім перезавантажте шлюз. Виберіть `Actions` -> `Reboot system` в правому верхньому куті.\n\n9. Переконайтеся, що шлюз працює належним чином у вікні інформації Zigbee. DeviceState повинен бути `OK`.\n\n10. Налаштуйте автоматичне додавання пристроїв до Home Assistant. Перейдіть до `Zigbee` -> `Config`, потім виберіть `Home Assistant MQTT Discovery` та `Clear States`. Збережіть зміни та знову **перезавантажте** SLS шлюз.\n\n<robo-wiki-note type=\"warning\">\n\nЯкщо у вас вже є активний SLS шлюз у вашому будинку, і ви зараз налаштовуєте ще один, то вони будуть конфліктувати один з одним. Щоб вирішити цю проблему, вам потрібно змінити канал на новому пристрої. Для цього перейдіть до `Zigbee` -> `Config` та змініть канал на інший (наприклад, канал 15).\n\n</robo-wiki-note>\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmVZMB1xQeB6ZLfSR6aUrN6cRSF296s8CMJt7E2jBJ5MjZ', type:'mp4'}]\" />\n\n## Парування SLS з MQTT\n\nПісля налаштування SLS Шлюзу вам потрібно підключити SLS Шлюз до Home Assistant. Відкрийте веб-інтерфейс SLS Шлюзу та перейдіть до `Settings/Link` -> `MQTT Setup`:\n\n\nДодайте адресу вашого брокера (адреса Raspberry Pi з Home Assistant у локальній мережі, ви можете знайти її за допомогою [мобільного додатку Fing](https://www.fing.com/products) або [інструменту командного рядка nmap](https://vitux.com/find-devices-connected-to-your-network-with-nmap/)), порт (за замовчуванням `1883`), ім'я користувача та пароль брокера (які ви створили раніше) та назву теми (ви можете вибрати будь-яку). Також, IP-адреса Raspberry Pi повинна бути статичною. Натисніть `Enable` та `Retain states`.\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmdNKDqwwy87VQEDDVsX5kpaDQm9wKKPEJUNJnhnjx6e5y', type:'mp4'}]\" />\n\nЗбережіть зміни. Тепер пристрої будуть автоматично відображатися в Home Assistant.\n\n## Підключення пристроїв\n\nПідключіть ваші пристрої, перейшовши до розділу `Zigbee` -> `Join`. Поставте ваші сенсори в режим парування, найпоширеніший спосіб переключити пристрій в режим підключення - утримувати його кнопку живлення або включати / вимикати його 5 разів. Натисніть кнопку `Enable Join`, щоб почати пошук пристроїв Zigbee. Ви побачите активні сенсори.\n\n<robo-wiki-picture src=\"home-assistant/switch-device.gif\" />\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/Qmdq3PBNY88QbYYqakwSLG2vn3mVUom3w3wsSWfTd1pzJA', type:'mp4'}]\" />\n\n\nТепер ви можете перейти до розділу [**Підписка на IoT**](/docs/sub-activate) та почати активувати підписку Robonomics.\n","tools":["SLS Firmware 2022.08.13 https://github.com/airalab/robonomics-hass-utils"],"fileInfo":{"path":"uk/sls-gateway.md","name":"sls-gateway"}}},"context":{}}