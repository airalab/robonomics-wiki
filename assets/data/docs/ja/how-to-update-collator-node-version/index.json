{"hash":"27d6626b76dcb92dd3ddfe09b4010e2c0ab01932","data":{"doc":{"id":"54eecad4db6fe1e3b4347df358bb2b12","title":"Robonomics Collatorノードバージョンの更新方法","description":"","contributors":["Leemo94"],"headings":[],"subtitles":[{"depth":2,"value":"","anchor":"#必要なコマンド"},{"depth":2,"value":"","anchor":"#ベースパスが設定されていないkusamaリレーチェーンデータベースの変更"}],"content":"\nこの投稿を読む前に、以下の記事を読むことをおすすめします：[\"Collator Nodeのビルド方法\"](/docs/how-to-build-collator-node)および[\"Robonomics Collatorの起動方法\"](/docs/how-to-launch-the-robonomics-collator)。\n\nの記事では、Robonomics Collatorノード（Ubuntuで実行）の更新に必要なコマンドと、その後の例を示します。\n\n## **必要なコマンド**\n\n0. 開始する前に、`root`としてログインしていることをおすすめします。そうでない場合は、以下を使用することをおすすめします：\n\n<code-helper copy>\n\n```shell\nsudo su -\n```\n\n</code-helper>\n\n1. Robonomicsサービスを停止します。\n\n<code-helper copy>\n\n```shell\nsystemctl stop robonomics.service\n```\n\n</code-helper>\n\n2. 以前のバージョンのRobonomicsを削除します（正しいディレクトリにいることを確認してください）。\n\n<code-helper copy>\n\n```shell\nrm -f robonomics.X.X.X-ubuntu-x86_64.tar.gz\n```\n\n</code-helper>\n\n3. Robonomicsの[最新リリース](https://github.com/airalab/robonomics/releases)バージョンを取得します。\n\n<code-helper copy>\n\n```shell\nwget https://github.com/airalab/robonomics/releases/vX.X.X/.....\n```\n</code-helper>\n\n\n4. ファイルを展開します。\n\n<code-helper copy>\n\n```shell\ntar -xf robonomics-X.X.X-x86_64-unknown-linux.gnu.tar.gz\n```\n</code-helper>\n\n5. ファイルを移動します。\n\n<code-helper copy>\n\n```shell\nmv robonomics /usr/local/bin/\n```\n</code-helper>\n\n<robo-wiki-note type=\"note\">\n\nこのファイルを、Robonomicsノードをインストールした正しいディレクトリに移動する必要があります。\n\n</robo-wiki-note>\n\n6. Robonomicsを起動します。\n\n<code-helper copy>\n\n```shell\nsystemctl start robonomics.service\n```\n</code-helper>\n\nCollatorノードをRobonomics v1.8.4にアップグレードする例：\n\n<code-helper>\n\n```shell\nsudo su -\ncd /home/admin\nsystemctl stop robonomics.service\nrm -f robonomics-1.7.3-x86_64-unknown-linux-gnu.tar.gz\nwget https://github.com/airalab/robonomics/releases/download/v1.8.4/robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\ntar -xf robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\nmv robonomics /usr/local/bin/\nsystemctl start robonomics.service\n\n```\n</code-helper>\n\n## **ベースパスが設定されていないKusamaリレーチェーンデータベースの変更**\n\nKusamaリレーチェーンの特定のスナップショットがノードにエラーを引き起こすことがあります。これにより、ノードが動作しなくなることがよくあります。壊れたリレーチェーンデータースによるエラーの例：\n\n<code-helper>\n\n```shell\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] GRANDPA voter error: could not complete a round on disk: Database\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] Essential task `grandpa-voter` failed. Shutting down service.\nDec 08 19:14:32 ns3159483 robonomics[1019836]: Error: Service(Other(\"Essential task failed.\"))\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\nec 08 19:14:33 ns3159483 robonomics[1022922]: Error: Service(Client(Backend(\"Invalid argument: Column families not opened: col12, col11, col10, col9, col8, col7, col6, col5, col4, col3, col2, col1, col0\")))\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\n```\n</code-helper>\n\nこのエラーを修正するには、既存のKusamaリレーチェーンデータベース（おそらくRocksDb）を削除し、ParityDbなどの別のDbで置き換える必要があります。次のコマンドを実行します：\n\n1. Robonomicsノードのディレクトリを見つけ、ファイルを確認します。\n\n<code-helper>\n\n```shell\ncd /home/robonomics/\nls -a\n```\n</code-helper>\n\n2. polkadotディレクトリが表示されることを確認し、chainsディレクトリに移動します。\n\n<code-helper>\n\n```shell\ncd /polkadot/chains/\nls -a\n```\n</code-helper>\n\n3. `ksmcc3` ディレクトリを削除します。\n\n<code-helper copy>\n\n```shell\nrm -r ksmcc3\n```\n</code-helper>\n\n4. 新しい`ksmcc3`ディレクトリを作成します。\n\n<code-helper>\n\n```shell\nmkdir ksmcc3\nchown -R robonomics:robonomics ksmcc3\ncd ksmcc3\n```\n\n</code-helper>\n\n5. 新しいスナップショットをダウンロードする必要があります。この例では、大幅にプルーンされたリレーチェンスナップショットを使用していますが、好みのスナップショットに置き換えることができます。\n\n<code-helper copy>\n\n```shell\nwget wget https://snaps.sik.rocks/ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n6. スナップショットがダウンロード中の間に、新しいセッションを開き、サービスファイルを編集します。\n\n\n<code-helper copy>\n\n```shell\nsudo nano /etc/systemd/system/robonomics.service\n```\n\n</code-helper>\n\nデータベースとプルーニングに関連するサービスファイル内の行を変更します。\n\n<code-helper copy>\n\n```shell\n  --database=paritydb \\\n  --state-pruning=100 \\\n  --blocks-pruning=100 \\\n  --execution=Wasm\n```\n\n</code-helper>\n\n  \n`Ctrl + S`を押してから`Ctrl + X`を押して、サービスファイルを保存して終了します。\n\n7. デーモンを再読み込みする必要があります。\n\n<code-helper copy>\n\n```shell\nsystemctl daemon-reload\n```\n</code-helper>\n\n\n8. この時点で、他のセッションでは、新しいDbがダウンードされていることを願っていますので、ファイルを展開します。\n\n<code-helper copy>\n\n```shell\ntar -xvzf ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n9. 展開が完了したら、次のコマンドを実行します。\n\n<code-helper copy>\n\n\n```shell\nchown -R robonomics:robonomics paritydb\n```\n\n</code-helper>\n\n10. これでサービスを開始し、エラーがないか監視し、リレーチェーンとパラチェーンの両方でピアリングされていることを確認できます。\n\n\n<code-helper copy>\n\n\n```shell\nsystemctl start robonomics && journalctl -fu robonomics\n```\n</code-helper>","tools":[],"fileInfo":{"path":"ja/how-to-update-collator-node-version.md","name":"how-to-update-collator-node-version"}}},"context":{}}