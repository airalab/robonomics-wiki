{"hash":"7cb61ecb7aece8a731b99edf4c65740f47020848","data":{"doc":{"id":"76eddb4aa0e02cf4d82d3b612562765e","title":"Comment mettre à jour la version du nœud Robonomics Collator","description":"","contributors":["Leemo94"],"headings":[],"subtitles":[{"depth":2,"value":"","anchor":"#commandes-requises"},{"depth":2,"value":"","anchor":"#modification-de-la-base-de-données-de-la-chaîne-de-relais-kusama-sans-chemin-de-base-défini"}],"content":"\nIl est recommandé de lire les articles suivants avant de lire ce post: [\"Comment construire un nœud Collator\"](/docs/how-to-build-collator-node) & [\"Comment lancer le Robonomics Collator\"](/docs/how-to-launch-the-robonomics-collator).\n\nCet article contient les commandes nécessaires pour mettre à jour un nœud collator Robonomics (fonctionnant sous Ubuntu), et donne également un exemple par la suite.\n\n## **Commandes requises**\n\n0. Avant de commencer, il est recommandé d'être connecté en tant que `root`, sinon, je vous recommande d'utiliser:\n\n<code-helper copy>\n\n```shell\nsudo su -\n```\n\n</code-helper>\n\n1. Arrêtez le service Robonomics:\n\n<code-helper copy>\n\n```shell\nsystemctl stop robonomics.service\n```\n\n</code-helper>\n\n2. Supprimez la version précédente de Robonomics (assurez-vous d'être dans le répertoire correct):\n\n<code-helper copy>\n\n```shell\nrm -f robonomics.X.X.X-ubuntu-x86_64.tar.gz\n```\n\n</code-helper>\n\n3. Obtenez la [dernière version](https://github.com/airalab/robonomics/releases) de Robonomics:\n\n<code-helper copy>\n\n```shell\nwget https://github.com/airalab/robonomics/releases/vX.X.X/.....\n```\n</code-helper>\n\n\n4. Extrayez le fichier:\n\n<code-helper copy>\n\n```shell\ntar -xf robonomics-X.X.X-x86_64-unknown-linux.gnu.tar.gz\n```\n</code-helper>\n\n5. Déplacez le fichier:\n\n<code-helper copy>\n\n```shell\nmv robonomics /usr/local/bin/\n```\n</code-helper>\n\n<robo-wiki-note type=\"note\">\n\nVous devez déplacer ce fichier dans le répertoire correct où vous avez installé le nœud Robonomics)\n\n</robo-wiki-note>\n\n6. Démarrez Robonomics:\n\n<code-helper copy>\n\n```shell\nsystemctl start robonomics.service\n```\n</code-helper>\n\nExemple de mise à niveau du nœud collator vers Robonomics v1.8.4:\n\n<code-helper>\n\n```shell\nsudo su -\ncd /home/admin\nsystemctl stop robonomics.service\nrm -f robonomics-1.7.3-x86_64-unknown-linux-gnu.tar.gz\nwget https://github.com/airalab/robonomics/releases/download/v1.8.4/robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\ntar -xf robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\nmv robonomics /usr/local/bin/\nsystemctl start robonomics.service\n\n```\n</code-helper>\n\n## **Modification de la base de données de la chaîne de relais Kusama sans chemin de base défini**\n\nIl arrive parfois que certains instantanés de la chaîne de relais Kusama provoquent des erreurs sur votre nœud. Cela entraîne souvent l'arrêt de votre nœud. Exemple d'erreur causée par une base de données de chaîne de relais corrompue:\n\n<code-helper>\n\n```shell\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] GRANDPA voter error: could not complete a round on disk: Database\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] Essential task `grandpa-voter` failed. Shutting down service.\nDec 08 19:14:32 ns3159483 robonomics[1019836]: Error: Service(Other(\"Essential task failed.\"))\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\nec 08 19:14:33 ns3159483 robonomics[1022922]: Error: Service(Client(Backend(\"Invalid argument: Column families not opened: col12, col11, col10, col9, col8, col7, col6, col5, col4, col3, col2, col1, col0\")))\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\n```\n</code-helper>\n\nPour résoudre cette erreur, vous devez supprimer votre base de données de chaîne de relais Kusama existante (probablement RocksDb) et la remplacer par une autre base de données telle que ParityDb. Exécutez les commandes suivantes:\n\n1. Trouvez le répertoire du nœud Robonomics et vérifiez les fichiers:\n\n<code-helper>\n\n```shell\ncd /home/robonomics/\nls -a\n```\n</code-helper>\n\n2. Vérifiez que vous voyez le répertoire polkadot, puis accédez au répertoire chains:\n\n<code-helper>\n\n```shell\ncd /polkadot/chains/\nls -a\n```\n</code-helper>\n\n3. Supprimez le répertoire `ksmcc3` :\n\n<code-helper copy>\n\n```shell\nrm -r ksmcc3\n```\n</code-helper>\n\n4. Créez un nouveau répertoire `ksmcc3`.\n\n<code-helper>\n\n```shell\nmkdir ksmcc3\nchown -R robonomics:robonomics ksmcc3\ncd ksmcc3\n```\n\n</code-helper>\n\n5. Maintenant, vous devez télécharger un nouvel instantané. Cet exemple utilise un instantané de chaîne de relais fortement élagué, mais vous pouvez le remplacer par n'importe quel instantané de votre choix.\n\n<code-helper copy>\n\n```shell\nwget wget https://snaps.sik.rocks/ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n6. Pendant que l'instantané se télécharge, ouvrez une nouvelle session et modifiez votre fichier de service:\n\n\n<code-helper copy>\n\n```shell\nsudo nano /etc/systemd/system/robonomics.service\n```\n\n</code-helper>\n\nModifiez les lignes du fichier de service qui concernent la base de données et l'élagage:\n\n<code-helper copy>\n\n```shell\n  --database=paritydb \\\n  --state-pruning=100 \\\n  --blocks-pruning=100 \\\n  --execution=Wasm\n```\n\n</code-helper>\n\n  \nUtilisez `Ctrl + S` puis `Ctrl + X` pour enregistrer et quitter le fichier de service.\n\n7. Maintenant, vous devez recharger votre démon.\n\n<code-helper copy>\n\n```shell\nsystemctl daemon-reload\n```\n</code-helper>\n\n\n8. À ce stade, dans votre autre session, espérons que la nouvelle base de données a été téléchargée, donc extrayez le fichier:\n\n<code-helper copy>\n\n```shell\ntar -xvzf ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n9. Après la fin du déballage, exécutez ce qui suit:\n\n<code-helper copy>\n\n\n```shell\nchown -R robonomics:robonomics paritydb\n```\n\n</code-helper>\n\n10. Maintenant, vous pouvez démarrer le service, le surveiller pour détecter d'éventuelles erreurs et vérifier qu'il est en liaison à la fois avec la chaîne de relais et la parachaine:\n\n\n<code-helper copy>\n\n\n```shell\nsystemctl start robonomics && journalctl -fu robonomics\n```\n</code-helper>","tools":[],"fileInfo":{"path":"fr/how-to-update-collator-node-version.md","name":"how-to-update-collator-node-version"}}},"context":{}}