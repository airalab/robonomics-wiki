{"hash":"17cc78d0b06fdca2940be0bd65777dc98e2b7d1b","data":{"doc":{"id":"1c6d8913140fd996697888ea3fb2cdfb","title":"Robonomics SLS Gateway","description":"","contributors":["LoSk-p","Fingerling42","nakata5321"],"headings":[],"subtitles":[{"depth":2,"value":"Firmware","anchor":"#firmware"},{"depth":3,"value":"Risoluzione dei problemi","anchor":"#risoluzione-dei-problemi"},{"depth":2,"value":"Configurazione","anchor":"#configurazione"},{"depth":2,"value":"Associazione SLS a MQTT","anchor":"#associazione-sls-a-mqtt"},{"depth":2,"value":"Collega i dispositivi","anchor":"#collega-i-dispositivi"}],"content":"\n**In questo articolo configurerai Robonomics SLS Gateway. Installerai il software richiesto per il gateway, lo configurerai e lo collegherai a Home Assistant.**\n\n<robo-wiki-picture src=\"home-assistant/sls_gateway.png\" />\n\n## Firmware\n\nPrima di tutto devi installare il firmware del microcontrollore del gateway. Prepara il gateway impostando gli interruttori `1` e `3` nella parte inferiore del SLS Gateway su `ON`, gli altri devono essere `OFF`.\n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-13.gif\" />\n\nCollega il gateway al tuo Raspberry Pi tramite la porta USB di tipo C sul gateway.\n\n<robo-wiki-picture src=\"home-assistant/sls-rpi.gif\" />\n\nClona il repository con il firmware sul tuo Raspberry Pi:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\ngit clone https://github.com/airalab/robonomics-hass-utils.git\n```\n\n</code-helper>\n\nVai a `robonomics-hass-utils/esp_firmware/linux`. Per flashare il gateway SLS devi eseguire gli script `Clear` e `Flash_16mb`.\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\ncd robonomics-hass-utils/esp_firmware/linux\nsudo chmod +x Clear.sh\nsudo chmod +x Flash_16mb.sh\n./Clear.sh\n./Flash_16mb.sh\n```\n\n</code-helper>\n\n### Risoluzione dei problemi\n\nSe riscontri problemi nell'aggiornamento del firmware del gateway, devi seguire ulteriori passaggi:\n\n1. Assicurati di avere installato il modulo pySerial:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\npip install pyserial\n```\n</code-helper>\n\n2. Concedi all'utente i diritti di accesso alla porta USB e riavvia il computer:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\nsudo usermod -a -G dialout $USER\nsudo reboot\n```\n</code-helper>\n\n3. In alcuni casi, è necessario modificare l'impostazione della larghezza di banda nello script per aggiornare il firmware. Apri lo script `Flash_16mb.sh` con l'editor `nano` e cambia il parametro baud da `921600` a un valore più piccolo (ad esempio, `115200`).\n\n## Configurazione\n\n1. Scollega il SLS Gateway dal computer. Imposta gli interruttori sul retro del gateway nella posizione corretta. Gli interruttori `5` (RX Zigbee a ESP) e `6` (TX Zigbee a ESP) devono essere nella posizione `ON`, gli altri devono essere `OFF`. \n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-56.gif\" />\n\n2. Collega il cavo di alimentazione di tipo C. La luce indicatrice al centro dovrebbe diventare verde.\n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-connect.gif\" />\n\n3. Al primo avvio, il gateway inizierà a condividere il Wi-Fi con l'SSID `zgw****`. Connettiti a questa rete. Tieni presente che il segnale potrebbe essere piuttosto debole, quindi è meglio tenere il gateway SLS più vicino al tuo computer. \n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-wifi.gif\" />\n\n4. Se la connessione è riuscita, si aprirà l'interfaccia web (o puoi trovarla all'indirizzo 192.168.1.1). \n\n5. Vedrai la pagina `Wi-Fi Settings`. Seleziona la tua rete Wi-Fi e inserisci la password. Premi il pulsante `Apply`. Il gateway si riavvierà e si collegherà alla tua rete Wi-Fi. \n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmSht6roENzrV6oqsQ1a5gp6GVCz54EDZdPAP8XVh9SCwH', type:'mp4'}]\" />\n\n6. Trova l'IP locale del gateway SLS per accedere all'interfaccia web. Per trovarlo puoi utilizzare [l'app mobile Fing](https://www.fing.com/products) o [lo strumento CLI nmap](https://vitux.com/find-devices-connected-to-your-network-with-nmap/). Il nome del gateway dovrebbe essere simile a questo: `zgw****`. Apri l'interfaccia web del gateway incollando l'IP del gateway nel browser.\n\n7. Vai a `Setting` -> `Hardware` e assicurati che le impostazioni siano simili all'immagine. Correggi le impostazioni se necessario e clicca sul pulsante `Save`:\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmeSksMxU9xkvvK7f81WDAYULiMFokK7P7KDVYEjv2MHjn', type:'mp4'}]\" />\n\nLa tabella con i valori richiesti:\n\n| Field                    | Value              |\n|--------------------------|:-------------------|\n| Zigbee module            | TI                 |\n| Zigbee UART RX           | 22                 |\n| Zigbee UART TX           | 23                 |\n| Zigbee RST Pin           | 18                 |\n| Zigbee BSL Pin           | 19                 |\n| Service Button Pin       | 33 (pullUP - true) |\n| Number addressable leds  | 0                  |\n| Led Red (or addr)        | 21                 |\n| Led Green                | 5                  |\n| Led Blue                 | 27                 |\n| I2C SDA                  | 255                |\n| I2C SCL                  | 255                |\n\n8. Riavvia quindi il gateway. Scegli `Actions` -> `Reboot system` nell'angolo in alto a destra.\n\n9. Assicurati che il gateway funzioni correttamente nella finestra delle informazioni Zigbee. Lo stato del dispositivo dovrebbe essere `OK`.\n\n10. Configura l'aggiunta automatica dei dispositivi a Home Assistant. Vai a `Zigbee` -> `Config` quindi scegli `Home Assistant MQTT Discovery` e `Clear States`. Salva le modifiche e **riavvia** il gateway SLS.\n\n<robo-wiki-note type=\"warning\">\n\nSe hai già un gateway SLS attivo nella tua casa e stai configurando un altro, entreranno in conflitto tra loro. Per risolvere questo problema devi cambiare il canale sul nuovo dispositivo. Per farlo, vai a `Zigbee` -> `Config` e cambia il canale con un altro (ad esempio, canale 15).\n\n</robo-wiki-note>\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmVZMB1xQeB6ZLfSR6aUrN6cRSF296s8CMJt7E2jBJ5MjZ', type:'mp4'}]\" />\n\n## Associazione SLS a MQTT\n\nDopo aver configurato il gateway SLS, devi collegare il gateway SLS a Home Assistant. Apri l'interfaccia web del gateway SLS e vai a `Settings/Link` -> `MQTT Setup`:\n\n\nAggiungi l'indirizzo del tuo broker (indirizzo del Raspberry Pi con Home Assistant nella rete locale, puoi trovarlo con [l'app mobile Fing](https://www.fing.com/products) o [lo strumento CLI nmap](https://vitux.com/find-devices-connected-to-your-network-with-nmap/)), la porta (predefinita è `1883`), il nome utente e la password del broker (che hai creato in precedenza) e il nome dell'argomento (puoi scegliere qualsiasi). Inoltre, l'indirizzo IP del Raspberry Pi deve essere statico. Fai clic su `Enable` e `Retain states`.\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmdNKDqwwy87VQEDDVsX5kpaDQm9wKKPEJUNJnhnjx6e5y', type:'mp4'}]\" />\n\nSalva le modifiche. Ora i dispositivi verranno mostrati automaticamente in Home Assistant.\n\n## Collega i dispositivi\n\nCollega i tuoi dispositivi andando su `Zigbee` -> `Join`. Metti i tuoi sensori in modalità di accoppiamento, il modo più comune per passare a modalità di connessione è tenere premuto il pulsante di accensione o accenderli/spegnere per 5 volte. Premi il pulsante `Enable Join` per iniziare la ricerca dei dispositivi Zigbee. Vedrai i sensori attivi.\n\n<robo-wiki-picture src=\"home-assistant/switch-device.gif\" />\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/Qmdq3PBNY88QbYYqakwSLG2vn3mVUom3w3wsSWfTd1pzJA', type:'mp4'}]\" />\n\n\nOra puoi andare alla sezione [**Sottoscrizione IoT**](/docs/sub-activate) e iniziare ad attivare la sottoscrizione Robonomics.\n","tools":["SLS Firmware 2022.08.13 https://github.com/airalab/robonomics-hass-utils"],"fileInfo":{"path":"it/sls-gateway.md","name":"sls-gateway"}}},"context":{}}