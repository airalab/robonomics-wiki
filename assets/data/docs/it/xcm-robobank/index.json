{"hash":"a79c60e1f44a7df053a4690e4cfebb76cc79c05a","data":{"doc":{"id":"4371d47c31227713aacfdc8222f0c959","title":"Substrate Cumulus Parachain Testsuite per il messaggio cross-chain","description":"","contributors":["ddulesov","boogerwooger","tubleronchik"],"headings":[],"subtitles":[{"depth":2,"value":"Upstream","anchor":"#upstream"},{"depth":2,"value":"Build & Run","anchor":"#build--run"},{"depth":2,"value":"Verifica che la configurazione iniziale funzioni","anchor":"#verifica-che-la-configurazione-iniziale-funzioni"},{"depth":3,"value":"Esempio:","anchor":"#esempio"},{"depth":3,"value":"Test di trasmissione dei messaggi UMP","anchor":"#test-di-trasmissione-dei-messaggi-ump"},{"depth":3,"value":"Test di trasmissione dei messaggi HRMP","anchor":"#test-di-trasmissione-dei-messaggi-hrmp"},{"depth":3,"value":"Altre opzioni","anchor":"#altre-opzioni"},{"depth":2,"value":"Testnet locale","anchor":"#testnet-locale"},{"depth":3,"value":"Crea una specifica di catena personalizzata","anchor":"#crea-una-specifica-di-catena-personalizzata"},{"depth":2,"value":"Hack parachain","anchor":"#hack-parachain"},{"depth":2,"value":"Learn More","anchor":"#learn-more"}],"content":"\n\nL'obiettivo principale di questo progetto è semplificare lo sviluppo del runtime di parachain, quando vengono utilizzati messaggi cross-chain. \nConsente lo sviluppo del codice di runtime con test di integrazione con un alto grado di ripetibilità e semplicità d'uso.\nAutomatizza la costruzione, la configurazione predefinita della rete (ad esempio 1 relay chain + 2 parachain), l'installazione dei canali di passaggio dei messaggi tra le parachain e l'esecuzione dei test di messaggistica, l'invio di messaggi, utilizzando la chiamata al runtime, il tutto costruito e composto in Python.\n\nXCM Testsuite viene utilizzato per testare il ciclo di produzione di Robobank - l'insieme di pallette Substrate, che consentono ai robot di registrarsi su parachain esterne, ricevere ordini prepagati, eseguirli e ricevere pagamenti utilizzando token esterni. Ciò consente ai robot di operare all'interno della rete Robonomics con tutta l'infrastruttura necessaria, ma allo stesso tempo, offrire i loro servizi su qualsiasi altra parachain.\n\nUn video di esempio è disponibile su [YouTube](https://www.youtube.com/watch?v=S_bZgsxngiM)\n\nI principali passaggi dello scenario di demo sono:\n- lanciare la relay chain e due parachain in un pacchetto di 6 processi\n- configurare i canali di messaggi XCM tra le parachain\n- registrare un robot in entrambe le parachain\n- creare un ordine per questo robot nella parachain client (riservando il pagamento per il completamento dell'ordine)\n- inviare un messaggio XCM alla parachain Robonomics\n- creare il record dell'ordine \"speculare\" sulla parachain Robonomics\n- il robot accetta l'ordine sulla parachain Robonomics\n- inviare un messaggio XCM sull'accettazione dell'ordine alla parachain client\n- accettare l'ordine sulla parachain client (riservando una penale per mancato completamento dell'ordine fino alla scadenza dell'ordine)\n- il robot completa l'ordine sulla parachain Robonomics\n- inviare un messaggio XCM sul completamento dell'ordine alla parachain client\n- regolare tutti i pagamenti (il pagamento del cliente viene trasferito al robot, così come la penale non utilizzata)\n- chiudere l'ordine1\n\n\n## Upstream\nQuesto progetto è un fork del\n[Substrate Developer Hub Node Template](https://github.com/substrate-developer-hub/substrate-node-template).\nContiene il codice dei pallette di runtime in fase di test.\nCome nel codice originale del nodo, le parachain si trovano nelle cartelle \"./pallets\", \"./runtime\", \"./node\".\n\nDifferenze con il modello originale di \"substrate-node-template\":\n- questo runtime del collatore ha il modulo gestore HRMP e può gestire i messaggi dalle parachain fratelli\n- test di simulazione del runtime pronto per i test XCM interni\n\n## Build & Run\nSetup consigliato (molto): \n```\nUbuntu 20, 16 Gb RAM, 8 CPU, 120 Gb SSD\n```\n[NOTA] La prima compilazione può richiedere molto tempo, fino a diverse ore su macchine non ottimali.\n\n[NOTA] Lo script funziona con le versioni FISSE (commit hash) di Polkadot(Rococo) nella relay chain e nelle parachain.\n\n[NOTA] Per impostazione predefinita, lo script ricrea lo stesso ambiente ad ogni avvio, rimuovendo tutti gli stati precedenti. Questo comportamento può essere modificato in \"config.sh\" utilizzando il parametro \"PERSISTENT\".\n\n\nEsegui lo script di compilazione e configurazione.  \n```bash\ngit clone https://github.com/airalab/xcm-robobank-prototype.git\ncd xcm-robobank-prototype\n./scripts/init.sh\n```\n\nAzioni di base dello script \"init.sh\":\n - leggi la configurazione (file \"config.sh\" con numero di revisione, chiavi e identificatori iniziali del nodo, parametro di persistenza dei dati della catena, ecc.)\n - configura i pacchetti del sistema operativo, Rust e Python\n - compila binari separati per la relay chain e anche per entrambe le parachain\n    - i binari verranno generati nella sottodirectory ./bin. \n - (opzionale) rimuove tutti i dati precedenti della catena per tutte le catene\n    - disabilitato se \"PERSISTENT=1\" è impostato in \"config.sh\"\n - viene eseguito come processi separati (con PID e pipe I/O separati):\n    - validatori della relay chain (ad esempio 4 validatori in esecuzione su una revisione stabile di Rococo)\n    - collatori per la parachain-100 (ad esempio un singolo collatore per la prima parachain che si sta sviluppando)\n    - collatori per la parachain-200 (ad esempio un singolo collatore per la seconda parachain che si sta sviluppando)\n - stampa tutte le endpoint, le porte sulla console, consentendo di studiare qualsiasi catena utilizzando app frontend (esploratore, DApp)\n - continua a stampare tutti i dati di output di tutte le catene sulla console\n\n[ATTENZIONE] Dopo il lancio, attendere che la rete sia attiva, assicurarsi che la finalizzazione del blocco sia iniziata e che le parachain siano registrate. Questi processi dovrebbero richiedere circa 5 minuti (50 blocchi x 6 secondi).\n\n## Verifica che la configurazione iniziale funzioni \n\nUtilizza il frontend standard di Polkadot e gli endpoint generati \"--ws-port\" per connettersi a ciascun nodo.\nApri [Polkadot application](https://polkadot.js.org/apps/?rpc=ws://localhost:9500/) per monitorare le catene. \n\n### Esempio:\nLocalhost, 4 validatori della relay chain, un collatore per la parachain-100, un collatore per la parachain-200:\n- [Relay validator 1](https://polkadot.js.org/apps/?rpc=ws://localhost:9500/)\n- [Relay validator 2](https://polkadot.js.org/apps/?rpc=ws://localhost:9501/)\n- [Relay validator 3](https://polkadot.js.org/apps/?rpc=ws://localhost:9502/)\n- [Relay validator 4](https://polkadot.js.org/apps/?rpc=ws://localhost:9503/)\n- [Parachain-100 collator](https://polkadot.js.org/apps/?rpc=ws://localhost:10054/)\n- [Parachain-200 collator](https://polkadot.js.org/apps/?rpc=ws://localhost:10055/)\n\n\nSe tutto funziona e il consenso è iniziato, possiamo procedere ad eseguire i nostri casi di test (in un nuovo terminale).\n\n### Test di trasmissione dei messaggi UMP\n```bash\n./scripts/init.sh ump\n```\nCrea un messaggio `Balance.transfer` in `parachain-100` e lo passa alla relay chain.\nQuando la relay chain riceve il messaggio, trasferisce 15 token dall'account `para 100` all'account Charlie.\n\n\n### Test di trasmissione dei messaggi HRMP\n```bash\n./scripts/init.sh ump\n```\n\nCrea un messaggio `Balance.transfer` in `parachain-100` e lo passa al `sibling 200`.\nPrima di ciò, fornisce all'account `subl 100` 1000 token e stabilisce un canale di comunicazione tra le parachain.\n```bash\n./scripts/init.sh hrmp\n```\nI messaggi successivi possono essere inviati eseguendo il sottocomando `hrmpm`. Non crea un canale e quindi viene eseguito più velocemente.\n```bash\n./scripts/init.sh hrmpm\n```\n\n### Altre opzioni\n```bash\n./scripts/init.sh help\n```\n\n## Testnet locale\n\n### Crea una specifica di catena personalizzata\n```\n./bin/polkadot build-spec --chain rococo-local --disable-default-bootnode > rococo_local.json\n```\n\nModifica rococo_local.json, sostituisci i parametri di bilancio e autorità con i tuoi.\n```json\n  \"keys\": [\n    [\n      \"\",\n      \"\",\n      {\n        \"grandpa\": \"\",\n        \"babe\": \"\",\n        \"im_online\": \"\",\n        \"para_validator\": \"\",\n        \"para_assignment\": \"\",\n        \"authority_discovery\": \"\"\n      }\n    ]\n```\n\nIndirizzo Polkadot per //Alice//stash (crittografia sr25519).\n```bash\n$ polkadot key inspect-key --scheme sr25519 --network substrate //Alice//stash\n```\n\n```text\nSecret Key URI `//Alice//stash` is account:\nSecret seed:      \n\nPublic key (hex): \n\nAccount ID:       \n\nSS58 Address:     \n```\n\nChiave di sessione grandpa di Polkadot per //Alice (crittografia ed25519).\n```bash\n$ polkadot key inspect-key --scheme ed25519 --network substrate //Alice\n```\n```text\nSecret Key URI `//Alice` is account:\nSecret seed:      \n\nPublic key (hex): \n\nAccount ID:       \n\nSS58 Address:     \n```\n\nIndirizzo Polkadot per //Alice (crittografia sr25519).\n```\n$ polkadot key inspect-key --scheme sr25519 --network substrate //Alice\n```\n```text\nSecret Key URI `//Alice` is account:\nSecret seed:      \n\nPublic key (hex): \n\nAccount ID:       \n\nSS58 Address:     \n```\n\nConverti rococo_local.json nel formato raw.\n```\n./bin/polkadot build-spec --chain rococo_local.json --raw --disable-default-bootnode > rococo_local.json\n```\nPer utilizzare la nuova specifica di catena, sostituisci il file rococo.json nella directory ./config/ con questo nuovo e riavvia la catena.\n```bash\n./scripts/init.sh run\n```\nPuoi modificare liberamente il codice. Il comando precedente ricostruirà il progetto e aggiornerà il nodo collator prima di avviarlo.\nCumulus è un software pre-release ancora in fase di sviluppo intensivo.\nStiamo utilizzando un commit specifico di polkadot [46c826f595021475fa5dbcd0987ed53f104e6e15 18 mar 2021](https://github.com/paritytech/polkadot/tree/46c826f595021475fa5dbcd0987ed53f104e6e15)\n\nPuoi utilizzare versioni più recenti del software. Per farlo, modifica POLKADOT_COMMIT in ./scipt/config.sh\nall'ultimo commit del ramo `rococo-v1`, elimina ./bin/polkadot e esegui \n```bash\n./scripts/init.sh run\n```\n\nAggiorna le dipendenze del progetto collator \n```bash\ncargo update\n./scripts/init.sh build\n```\nAlcune dipendenze probabilmente richiedono nuove funzionalità del toolchain di Rust. Questo progetto si basa su Rust `nightly-2021-01-26`\nAggiorna la versione del toolchain di Rust in ./scripts/config.sh prima di compilare.\n\n## Hack parachain\n[Aggiungi un pallet esterno](https://substrate.dev/docs/en/tutorials/add-a-pallet/) - dovrebbe probabilmente essere in \"ulteriori informazioni\"?\n## Learn More\n\nFai riferimento al [Substrate Developer Hub Node Template](https://github.com/substrate-developer-hub/substrate-node-template) per saperne di più sulla struttura di questo progetto, sulle capacità che incapsula e sul modo in cui tali capacità sono implementate. Puoi saperne di più su [Il percorso di un blocco di parachain](https://polkadot.network/the-path-of-a-parachain-block/) sul blog ufficiale di Polkadot. [Parity Cumulus Workshop](https://substrate.dev/cumulus-workshop/#/)\n","tools":[],"fileInfo":{"path":"it/xcm-robobank.md","name":"xcm-robobank"}}},"context":{}}