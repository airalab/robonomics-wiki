{"hash":"e98ab459510abb0b40ca4afdebba8e31d006b6ef","data":{"doc":{"id":"63a149194297b1a03eb2f1210b92a68e","title":"How to Update Robonomics Collator Node Version","description":"","contributors":["Leemo94"],"headings":[],"subtitles":[{"depth":2,"value":"","anchor":"#required-commands"},{"depth":2,"value":"","anchor":"#changing-kusama-relay-chain-database-with-no-base-path-set"}],"content":"\nIt is recommended to have read the following articles prior to reading this post: [\"How to Build Collator Node\"](/docs/how-to-build-collator-node) & [\"How to Launch the Robonomics Collator\"](/docs/how-to-launch-the-robonomics-collator).\n\nThis article contains the commands required to update a Robonomics collator node (running on Ubuntu), and also gives an example afterwards.\n\n## **Required Commands**\n\n0. Before you begin, it is recommended that you are logged in as `root`, if not, then I would recommend that you use:\n\n<code-helper copy>\n\n```shell\nsudo su -\n```\n\n</code-helper>\n\n1. Stop the Robonomics service:\n\n<code-helper copy>\n\n```shell\nsystemctl stop robonomics.service\n```\n\n</code-helper>\n\n2. Remove previous version of Robonomics (make sure you are in the correct directory):\n\n<code-helper copy>\n\n```shell\nrm -f robonomics.X.X.X-ubuntu-x86_64.tar.gz\n```\n\n</code-helper>\n\n3. Get the [latest release](https://github.com/airalab/robonomics/releases) version of Robonomics:\n\n<code-helper copy>\n\n```shell\nwget https://github.com/airalab/robonomics/releases/vX.X.X/.....\n```\n</code-helper>\n\n\n4. Extract the file:\n\n<code-helper copy>\n\n```shell\ntar -xf robonomics-X.X.X-x86_64-unknown-linux.gnu.tar.gz\n```\n</code-helper>\n\n5. Move the file:\n\n<code-helper copy>\n\n```shell\nmv robonomics /usr/local/bin/\n```\n</code-helper>\n\n<robo-wiki-note type=\"note\">\n\nYou need to move this file to the correct directory which you installed the Robonomics node)\n\n</robo-wiki-note>\n\n6. Start Robonomics:\n\n<code-helper copy>\n\n```shell\nsystemctl start robonomics.service\n```\n</code-helper>\n\nExample for upgrading collator node to Robonomics v1.8.4:\n\n<code-helper>\n\n```shell\nsudo su -\ncd /home/admin\nsystemctl stop robonomics.service\nrm -f robonomics-1.7.3-x86_64-unknown-linux-gnu.tar.gz\nwget https://github.com/airalab/robonomics/releases/download/v1.8.4/robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\ntar -xf robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\nmv robonomics /usr/local/bin/\nsystemctl start robonomics.service\n\n```\n</code-helper>\n\n## **Changing Kusama Relay Chain Database with No Base Path Set**\n\nThere are times where certain snapshots of the Kusama Relay Chain cause your node to have errors. This will often cause your node to stop working. Example error caused by a corrupt Relay Chain database:\n\n<code-helper>\n\n```shell\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] GRANDPA voter error: could not complete a round on disk: Database\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] Essential task `grandpa-voter` failed. Shutting down service.\nDec 08 19:14:32 ns3159483 robonomics[1019836]: Error: Service(Other(\"Essential task failed.\"))\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\nec 08 19:14:33 ns3159483 robonomics[1022922]: Error: Service(Client(Backend(\"Invalid argument: Column families not opened: col12, col11, col10, col9, col8, col7, col6, col5, col4, col3, col2, col1, col0\")))\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\n```\n</code-helper>\n\nIn order to fix this error, you should remove your existing Kusama Relay Chain database (likely RocksDb) and replace it with another Db such as ParityDb. Execute the following commands:\n\n1. Find the directory of Robonomics node and check the files:\n\n<code-helper>\n\n```shell\ncd /home/robonomics/\nls -a\n```\n</code-helper>\n\n2. Confirm that you see the polkadot directory, and then navigate to the chains directory:\n\n<code-helper>\n\n```shell\ncd /polkadot/chains/\nls -a\n```\n</code-helper>\n\n3. Delete the `ksmcc3` directory:\n\n<code-helper copy>\n\n```shell\nrm -r ksmcc3\n```\n</code-helper>\n\n4. Make a new `ksmcc3` directory.\n\n<code-helper>\n\n```shell\nmkdir ksmcc3\nchown -R robonomics:robonomics ksmcc3\ncd ksmcc3\n```\n\n</code-helper>\n\n5. Now you need to download a new snapshot. This example uses a heavily pruned relay chain snapshot, but you can swap it for any snapshot you prefer.\n\n<code-helper copy>\n\n```shell\nwget wget https://snaps.sik.rocks/ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n6. Whilst the snapshot is downloading, open a new session and edit your service file:\n\n\n<code-helper copy>\n\n```shell\nsudo nano /etc/systemd/system/robonomics.service\n```\n\n</code-helper>\n\nModify lines within the service file which relate to the database and pruning:\n\n<code-helper copy>\n\n```shell\n  --database=paritydb \\\n  --state-pruning=100 \\\n  --blocks-pruning=100 \\\n  --execution=Wasm\n```\n\n</code-helper>\n\n  \nUse `Ctrl + S` and then `Ctrl + X` to save and exit the service file.\n\n7. Now you need to reload your daemon.\n\n<code-helper copy>\n\n```shell\nsystemctl daemon-reload\n```\n</code-helper>\n\n\n8. By this time, in your other session, hopefully the new Db has downloaded, so extract the file:\n\n<code-helper copy>\n\n```shell\ntar -xvzf ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n9. After the unpacking is completed, execute the following:\n\n<code-helper copy>\n\n\n```shell\nchown -R robonomics:robonomics paritydb\n```\n\n</code-helper>\n\n10. Now you can start the service, monitor it for any errors, and check that it is peering on both the relay chain and the parachain:\n\n\n<code-helper copy>\n\n\n```shell\nsystemctl start robonomics && journalctl -fu robonomics\n```\n</code-helper>","tools":[],"fileInfo":{"path":"how-to-update-collator-node-version.md","name":"how-to-update-collator-node-version"}}},"context":{}}