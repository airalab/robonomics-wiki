{"hash":"0fc731af9b90653b97e5d5b575cb73fa2319c9c4","data":{"doc":{"id":"e82e9ccd4a21a499b354a7f1a38689b8","title":"如何更新Robonomics Collator节点版本","description":"","contributors":["Leemo94"],"headings":[],"subtitles":[{"depth":2,"value":"","anchor":"#所需命令"},{"depth":2,"value":"","anchor":"#在未设置基本路径的情况下更改kusama-relay-chain数据库"}],"content":"\n在阅读本文之前，建议您先阅读以下文章：[\"如何构建Collator节点\"](/docs/how-to-build-collator-node)和[\"如何启动Robonomics Collator\"](/docs/how-to-launch-the-robonomics-collator)。\n\n本文包含更新Robonomics Collator节点（在Ubuntu上运行）所需的命令，并在之后给出一个示例。\n\n## **所需命令**\n\n0. 在开始之前，建议您以`root`身份登录，如果没有，请使用以下命令：\n\n<code-helper copy>\n\n```shell\nsudo su -\n```\n\n</code-helper>\n\n1. 停止Robonomics服务：\n\n<code-helper copy>\n\n```shell\nsystemctl stop robonomics.service\n```\n\n</code-helper>\n\n2. 删除之前的Robonomics版本（确保您在正确的目录中）：\n\n<code-helper copy>\n\n```shell\nrm -f robonomics.X.X.X-ubuntu-x86_64.tar.gz\n```\n\n</code-helper>\n\n3. 获取[最新版本](https://github.com/airalab/robonomics/releases)的Robonomics：\n\n<code-helper copy>\n\n```shell\nwget https://github.com/airalab/robonomics/releases/vX.X.X/.....\n```\n</code-helper>\n\n\n4. 解压文件：\n\n<code-helper copy>\n\n```shell\ntar -xf robonomics-X.X.X-x86_64-unknown-linux.gnu.tar.gz\n```\n</code-helper>\n\n5. 移动文件：\n\n<code-helper copy>\n\n```shell\nmv robonomics /usr/local/bin/\n```\n</code-helper>\n\n<robo-wiki-note type=\"note\">\n\n您需要将此文件移动到您安装Robonomics节点的正确目录中）\n\n</robo-wiki-note>\n\n6. 启动Robonomics：\n\n<code-helper copy>\n\n```shell\nsystemctl start robonomics.service\n```\n</code-helper>\n\n将Collator节点升级到Robonomics v1.8.4的示例：\n\n<code-helper>\n\n```shell\nsudo su -\ncd /home/admin\nsystemctl stop robonomics.service\nrm -f robonomics-1.7.3-x86_64-unknown-linux-gnu.tar.gz\nwget https://github.com/airalab/robonomics/releases/download/v1.8.4/robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\ntar -xf robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\nmv robonomics /usr/local/bin/\nsystemctl start robonomics.service\n\n```\n</code-helper>\n\n## **在未设置基本路径的情况下更改Kusama Relay Chain数据库**\n\n有时，Kusama Relay Chain的某些快照会导致您的节点出现错误。这通常会导致节点停止工作。由损坏的Relay Chain数据库引起的示例错误：\n\n<code-helper>\n\n```shell\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] GRANDPA voter error: could not complete a round on disk: Database\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] Essential task `grandpa-voter` failed. Shutting down service.\nDec 08 19:14:32 ns3159483 robonomics[1019836]: Error: Service(Other(\"Essential task failed.\"))\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\nec 08 19:14:33 ns3159483 robonomics[1022922]: Error: Service(Client(Backend(\"Invalid argument: Column families not opened: col12, col11, col10, col9, col8, col7, col6, col5, col4, col3, col2, col1, col0\")))\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\n```\n</code-helper>\n\n为了修复此错误，您应该删除现有的Kusama Relay Chain数据库（可能是RocksDb），并将其替换为其他数据库，如ParityDb。执行以下命令：\n\n1. 找到Robonomics节点的目录并检查文件：\n\n<code-helper>\n\n```shell\ncd /home/robonomics/\nls -a\n```\n</code-helper>\n\n2. 确认您看到了polkadot目录，然后进入chains目录：\n\n<code-helper>\n\n```shell\ncd /polkadot/chains/\nls -a\n```\n</code-helper>\n\n3.删除`ksmcc3`目录：\n\n<code-helper copy>\n\n```shell\nrm -r ksmcc3\n```\n</code-helper>\n\n4. 创建一个新的`ksmcc3`目录。\n\n<code-helper>\n\n```shell\nmkdir ksmcc3\nchown -R robonomics:robonomics ksmcc3\ncd ksmcc3\n```\n\n</code-helper>\n\n5. 现在您需要下载一个新的快照。此示例使用了一个经过大量修剪的Relay Chain快照，但您可以将其替换为任何您喜欢的快照。\n\n<code-helper copy>\n\n```shell\nwget wget https://snaps.sik.rocks/ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n6. 在快照下载时，打开一个新的会话并编辑您的服务文件：\n\n\n<code-helper copy>\n\n```shell\nsudo nano /etc/systemd/system/robonomics.service\n```\n\n</code-helper>\n\n修改与数据库和修剪相关的服务文件中的行：\n\n<code-helper copy>\n\n```shell\n  --database=paritydb \\\n  --state-pruning=100 \\\n  --blocks-pruning=100 \\\n  --execution=Wasm\n```\n\n</code-helper>\n\n  \n使用`Ctrl + S`然后`Ctrl + X`保存并退出服务文件。\n\n7. 现在您需要重新加载守护程序。\n\n<code-helper copy>\n\n```shell\nsystemctl daemon-reload\n```\n</code-helper>\n\n\n8. 到此时，在您的其他会话中，希望新的数据库已经下载完成，因此解压文件：\n\n<code-helper copy>\n\n```shell\ntar -xvzf ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n9. 解压完成后，执行以下操作：\n\n<code-helper copy>\n\n\n```shell\nchown -R robonomics:robonomics paritydb\n```\n\n</code-helper>\n\n10. 现在您可以启动服务，监视任何错误，并检查它是否同时连接到Relay Chain和Parachain。\n\n\n<code-helper copy>\n\n\n```shell\nsystemctl start robonomics && journalctl -fu robonomics\n```\n</code-helper>","tools":[],"fileInfo":{"path":"zh/how-to-update-collator-node-version.md","name":"how-to-update-collator-node-version"}}},"context":{}}