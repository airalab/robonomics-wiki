{"hash":"a1431821b0627c4aec2e4634c198ee9a8721e6df","data":{"doc":{"id":"5c95cdeabd41575011fefb91cf8af3e8","title":"Backup Services","description":"","contributors":["tubleronchik","LoSk-p"],"headings":[],"subtitles":[{"depth":2,"value":"Creating Home Assistant Configuration's Backup","anchor":"#creating-home-assistant-configurations-backup"},{"depth":2,"value":"Restoring Home Assistant Configuration from Backup","anchor":"#restoring-home-assistant-configuration-from-backup"},{"depth":2,"value":"Restore Mosquitto and Zigbee2MQTT Configuration for Home Assistant Core Installation Method","anchor":"#restore-mosquitto-and-zigbee2mqtt-configuration-for-home-assistant-core-installation-method"},{"depth":2,"value":"Backup Mosquitto and Zigbee2MQTT Configuration for Home Assistant Docker Installation Method","anchor":"#backup-mosquitto-and-zigbee2mqtt-configuration-for-home-assistant-docker-installation-method"},{"depth":2,"value":"Backup Buttons","anchor":"#backup-buttons"}],"content":"\n**In this article, you will learn how to generate backups of your Home Assistant configuration and restore it when needed. To create backups, a service is called that generates a secure archive with configuration files. Also service adds Mosquitto brocker and Zigbee2MQTT configuration  to backup if exist. This service then adds the archive to IPFS and stores the resulting CID in Robonomics Digital Twin.**\n## Creating Home Assistant Configuration's Backup\n\nCreating a backup allows you to easily restore your Home Assistant configuration in the event of a failure.\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmZN5LfWR4XwAiZ3jEcw7xbCnT81NsF5XE3XFaNhMm5ba1', type:'mp4'}]\" />\n\n<robo-wiki-note type=\"warning\" title=\"WARNING\">\n\nIn order to backup and restore your configuration, it is necessary to use a **custom IPFS gateway** such as Pinata. Without it, your backup will be stored solely on your local IPFS node, which may prevent you from restoring your Home Assistant configuration in the event of a local node failure.\n\n</robo-wiki-note>\n\n1. In the web interface of Home Assistant go to `Developer Tools` -> `Services`. Search for `Robonomics: Save Backup to Robonomics` and press `CALL SERVICE`.\n\n2. Wait until you see the notification `Backup was updated in Robonomics` appear in `Notification`.\n\n<robo-wiki-note type=\"warning\" title=\"WARNING\">\n\nDo not attempt to create a backup or restore configuration immediately after loading Home Assistant and Robonomics Integration. Please **wait for approximately 5 minutes** to allow for the initial setup to complete.\n\n</robo-wiki-note>\n\nService arguments:\n- **Full Backup**  (default: False) - add database to the backup, so history of entity states will be stored too.\n- **Path to mosquitto password file** (default: `/etc/mosquitto`) - If you used Home Assistant Core or Docker installation methods and don't have default path to Mosquitto brocker, you should change this parameter. *Not needed for Home Assistant OS or Superviser*.\n\n## Restoring Home Assistant Configuration from Backup\n\nIn order to restore your configuration, you will need an installed Home Assistant and Robonomics Integration. \n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmNcJpHWWuZzwNCQryTw5kcki49oNTjEb8xvnfffSYfRVa', type:'mp4'}]\" />\n\n<robo-wiki-note type=\"warning\" title=\"WARNING\">\n\nTo ensure successful restoration of your configuration in Home Assistant Core and Docker installation methods, you need to perform additional setup steps as described at the end of the page.\n\n</robo-wiki-note>\n\n1. Install Home Assisntant with Robonomics Integration (if it is not installed yet), following the steps from the article for the [desired installation method](https://wiki.robonomics.network/docs/robonomics-smart-home-overview/#start-here-your-smart-home).\n\n2.  [Set up Robonomics Integration](https://wiki.robonomics.network/docs/robonomics-hass-integration) using **the same seeds** you used in previous Robonomics configuration. If you subscription has ended, [reactivate it](https://wiki.robonomics.network/docs/sub-activate).\n\n3. In the web interface of Home Assistant go to `Developer Tools` -> `Services`. Search for `Robonomics: Restore from the Backup in Robonomics` and press `CALL SERVICE`. Navigate to the `Overview` page, to check the status of your backup, .\n\n4. After restoring, Home Assistant will automatically restart. If for some reason Home Assistant does not restart, you can check the restoration status by monitoring the state of the `robonomics.backup` entity. If the status is `restored` you will need to manually restart Home Assistant by navigating to `Settings` > `System` and clicking on the `RESTART` button located in the upper right corner.\n\n5. If your backup includes the Zigbee2MQTT or Mosquitto configuration, you need to restart these services to enable the new configuration. You can do this manually by restarting the services individually, or you can simply restart the Home Assistant computer to ensure all services are restarted.\n\nService arguments:\n- **Path to mosquitto password file** (default: `/etc/mosquitto`) - If you used Home Assistant Core or Docker installation methods and have not default path to Mosquitto brocker, you should change this parameter. *Not needed for Home Assistant OS or Superviser*.\n- **Path to Zigbee2MQTT config**  (default: `/opt/zigbee2mqtt`) - If you used Home Assistant Core or Docker installation methods and have not default path to Zigbee2MQTT, you should change this parameter. *Not needed for Home Assistant OS or Superviser*.\n\n## Restore Mosquitto and Zigbee2MQTT Configuration for Home Assistant Core Installation Method\n\nIf the backup includes the configuration for Mosquitto or Zigbee2MQTT, during the restore process, they will be placed in the default path or in the path specified in the arguments. However, if you installed the Robonomics integration in an existing Home Assistant Core *(not from the preinstalled Robonomics image)*, the `homeassistant` user may not have access to this path.\n\nSo to restore the configuration of Mosquitto and Zigbee2MQTT, you need to grant the necessary read permissions to the user `homeassistant`:\n```bash\nsudo chmod a+w /opt/zigbee2mqtt /etc/mosquitto\n```\n\n## Backup Mosquitto and Zigbee2MQTT Configuration for Home Assistant Docker Installation Method\n\nTo backup the Mosquitto and Zigbee2MQTT configurations from a Docker container, you need to create volumes for their respective configurations. This can be achieved by running your Home Assistant container with additional arguments:\n\n```bash\ndocker run -d \\\n  --name homeassistant \\\n  --privileged \\\n  --restart=unless-stopped \\\n  -e TZ=MY_TIME_ZONE \\\n  -v /PATH_TO_YOUR_CONFIG:/config \\\n  -v /etc/mosquitto:/etc/mosquitto \\\n  -v /etc/mosquitto:/opt/zigbee2mqtt \\\n  --network=host \\\n  ghcr.io/home-assistant/home-assistant:stable\n```\n\nor make changes in your `compose.yaml` file:\n\n```yaml\nversion: '3'\nservices:\n  homeassistant:\n    container_name: homeassistant\n    image: \"ghcr.io/home-assistant/home-assistant:stable\"\n    volumes:\n      - /PATH_TO_YOUR_CONFIG:/config\n      - /etc/localtime:/etc/localtime:ro\n      - /etc/mosquitto:/etc/mosquitto\n      - /etc/mosquitto:/opt/zigbee2mqtt\n    restart: unless-stopped\n    privileged: true\n    network_mode: host\n```\n<robo-wiki-note type=\"note\" title=\"Note\">\n\nPlease note that the default paths for Mosquitto and Zigbee2MQTT configurations are `/etc/mosquitto` and `/opt/zigbee2mqtt`, respectively. However, these paths may vary depending on your specific setup.\n\n</robo-wiki-note>\n\n## Backup Buttons\n\nIn addition to using services to work with backups, you can simplify the process by using the `button.create_backup` and `button.restore_from_backup` buttons from the Robonomics integration. These buttons invoke the respective services with default parameters (the backup button creates a backup without history).\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/Qmc1fexYaJMsK6ch6JhjL6aqnAwqYNAzo5nEwYgDpnp4gj', type:'mp4'}]\" />\n\nTo add buttons to your dashboard, follow these steps:\n\n1. Click on the three dots in the top right corner of the dashboard.\n2. Select `Edit Dashboard`.\n3. Click on the `Add Card` button in the bottom right corner.\n4. Choose the `Entities` card.\n5. In the `Entities` field, search for the button.create_backup and button.restore_from_backup entities.\n6. Press `Save` to add the entities to the card.\n7. Finish editing by clicking the `Done` button in the top right corner.","tools":["Robonomics Home Assistant Integration 1.4.2 https://github.com/airalab/homeassistant-robonomics-integration"],"fileInfo":{"path":"backup-services.md","name":"backup-services"}}},"context":{}}