{"hash":"05a4be488e65418d58145d5a06af9b7688a849e0","data":{"doc":{"id":"60873bccb7a70398aacee5b3ef752969","title":"Robonomics SLS Gateway","description":"","contributors":["LoSk-p","Fingerling42","nakata5321"],"headings":[],"subtitles":[{"depth":2,"value":"Firmware","anchor":"#firmware"},{"depth":3,"value":"Solución de problemas","anchor":"#solución-de-problemas"},{"depth":2,"value":"Configuración","anchor":"#configuración"},{"depth":2,"value":"Emparejamiento de SLS con MQTT","anchor":"#emparejamiento-de-sls-con-mqtt"},{"depth":2,"value":"Conectar Dispositivos","anchor":"#conectar-dispositivos"}],"content":"\n**En este artículo configurarás Robonomics SLS Gateway. Instalarás el software necesario para la puerta de enlace, lo configurarás y lo conectarás a Home Assistant.**\n\n<robo-wiki-picture src=\"home-assistant/sls_gateway.png\" />\n\n## Firmware\n\nPrimero debes instalar el firmware del microcontrolador de la puerta de enlace. Prepara la puerta de enlace configurando los interruptores `1` y `3` en la parte inferior de SLS Gateway en `ON`, los demás deben estar en `OFF`.\n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-13.gif\" />\n\nConecta la puerta de enlace a tu Raspberry Pi a través del puerto USB tipo C en la puerta de enlace.\n\n<robo-wiki-picture src=\"home-assistant/sls-rpi.gif\" />\n\nClona el repositorio con el firmware en tu Raspberry Pi:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\ngit clone https://github.com/airalab/robonomics-hass-utils.git\n```\n\n</code-helper>\n\nVe a `robonomics-hass-utils/esp_firmware/linux`. Para flashear la puerta de enlace SLS, debes ejecutar los scripts `Clear` y `Flash_16mb`.\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\ncd robonomics-hass-utils/esp_firmware/linux\nsudo chmod +x Clear.sh\nsudo chmod +x Flash_16mb.sh\n./Clear.sh\n./Flash_16mb.sh\n```\n\n</code-helper>\n\n### Solución de problemas\n\nSi tienes problemas al actualizar el firmware de la puerta de enlace, debes seguir estos pasos adicionales:\n\n1. Asegúrate de tener instalado el módulo pySerial:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\npip install pyserial\n```\n</code-helper>\n\n2. Otorga derechos de acceso al puerto USB a tu usuario y reinicia la computadora:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\nsudo usermod -a -G dialout $USER\nsudo reboot\n```\n</code-helper>\n\n3. En algunos casos, es necesario cambiar la configuración de ancho de banda en el script para actualizar el firmware. Abre el script `Flash_16mb.sh` con el editor `nano` y cambia el parámetro de velocidad de transmisión (`baud`) de `921600` a un valor más bajo (por ejemplo, `115200`).\n\n## Configuración\n\n1. Desconecta la puerta de enlace SLS de la computadora. Configura los interruptores en la parte posterior de la puerta de enlace en la posición correcta. Los interruptores `5` (RX Zigbee a ESP) y `6` (TX Zigbee a ESP) deben estar en la posición `ON`, los demás deben estar en `OFF`. \n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-56.gif\" />\n\n2. Conecta el cable de alimentación tipo C. La luz indicadora en el centro debe ponerse verde.\n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-connect.gif\" />\n\n3. En el primer inicio, la puerta de enlace comenzará a compartir Wi-Fi con el SSID `zgw****`. Conéctate a esta red. Ten en cuenta que la señal puede ser bastante débil, por lo que es mejor mantener la puerta de enlace SLS más cerca de tu computadora. \n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-wifi.gif\" />\n\n4. Si la conexión es exitosa, se abrirá la interfaz web (o puedes encontrarla en la dirección 192.168.1.1). \n\n5. Verás la página `Wi-Fi Settings`. Selecciona tu Wi-Fi e ingresa la contraseña. Presiona el botón `Apply`. La puerta de enlace se reiniciará y se conectará a tu red Wi-Fi. \n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmSht6roENzrV6oqsQ1a5gp6GVCz54EDZdPAP8XVh9SCwH', type:'mp4'}]\" />\n\n6. Encuentra la IP local de la puerta de enlace SLS para acceder a la interfaz web. Puedes usar la aplicación móvil [Fing](https://www.fing.com/products) o la herramienta de línea de comandos [nmap](https://vitux.com/find-devices-connected-to-your-network-with-nmap/) para encontrarla. El nombre de la puerta de enlace debe verse así: `zgw****`. Abre la interfaz web de la puerta de enlace pegando la IP de la puerta de enlace en un navegador.\n\n7. Ve a `Setting` -> `Hardware` y asegúrate de que la configuración se vea como en la imagen. Corrige la configuración si es necesario y haz clic en el botón `Save`:\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmeSksMxU9xkvvK7f81WDAYULiMFokK7P7KDVYEjv2MHjn', type:'mp4'}]\" />\n\nLa tabla con los valores requeridos:\n\n| Field                    | Value              |\n|--------------------------|:-------------------|\n| Zigbee module            | TI                 |\n| Zigbee UART RX           | 22                 |\n| Zigbee UART TX           | 23                 |\n| Zigbee RST Pin           | 18                 |\n| Zigbee BSL Pin           | 19                 |\n| Service Button Pin       | 33 (pullUP - true) |\n| Number addressable leds  | 0                  |\n| Led Red (or addr)        | 21                 |\n| Led Green                | 5                  |\n| Led Blue                 | 27                 |\n| I2C SDA                  | 255                |\n| I2C SCL                  | 255                |\n\n8. Luego reinicia la puerta de enlace. Elige `Actions` -> `Reboot system` en la esquina superior derecha.\n\n9. Asegúrate de que la puerta de enlace funcione correctamente en la ventana de información de Zigbee. El estado del dispositivo (`DeviceState`) debe ser `OK`.\n\n10. Configura la adición automática de dispositivos a Home Assistant. Ve a `Zigbee` -> `Config` y elige `Home Assistant MQTT Discovery` y `Clear States`. Guarda los cambios y **reinicia** la puerta de enlace SLS.\n\n<robo-wiki-note type=\"warning\">\n\nSi ya tienes una puerta de enlace SLS activa en tu hogar y ahora estás configurando otra, entrarán en conflicto entre sí. Para resolver este problema, debes cambiar el canal en el nuevo dispositivo. Para hacer esto, ve a `Zigbee` -> `Config` y cambia el canal a otro (por ejemplo, canal 15).\n\n</robo-wiki-note>\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmVZMB1xQeB6ZLfSR6aUrN6cRSF296s8CMJt7E2jBJ5MjZ', type:'mp4'}]\" />\n\n## Emparejamiento de SLS con MQTT\n\nDespués de configurar la puerta de enlace SLS, debes conectarla a Home Assistant. Abre la interfaz web de la puerta de enlace SLS y ve a `Settings/Link` -> `MQTT Setup`:\n\n\nAgrega la dirección de tu broker (dirección de la Raspberry Pi con Home Assistant en la red local, puedes encontrarla con la aplicación móvil [Fing](https://www.fing.com/products) o la herramienta de línea de comandos [nmap](https://vitux.com/find-devices-connected-to-your-network-with-nmap/)), el puerto (por defecto es `1883`), tu nombre de usuario y contraseña del broker (que creaste anteriormente) y el nombre del tema (puedes elegir cualquier nombre). Además, la dirección IP de la Raspberry Pi debe ser estática. Haz clic en `Enable` y `Retain states`.\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmdNKDqwwy87VQEDDVsX5kpaDQm9wKKPEJUNJnhnjx6e5y', type:'mp4'}]\" />\n\nGuarda los cambios. Ahora los dispositivos se mostrarán automáticamente en Home Assistant.\n\n## Conectar Dispositivos\n\nConecta tus dispositivos yendo a `Zigbee` -> `Join`. Pon tus sensores en modo de emparejamiento, la forma más común de cambiar un dispositivo al modo de conexión es mantener presionado su botón de encendido o encender/apagarlos 5 veces. Presiona el botón `Enable Join`  para comenzar a buscar dispositivos Zigbee. Verás sensores activos.\n\n<robo-wiki-picture src=\"home-assistant/switch-device.gif\" />\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/Qmdq3PBNY88QbYYqakwSLG2vn3mVUom3w3wsSWfTd1pzJA', type:'mp4'}]\" />\n\n\nAhora puedes ir a la sección [**Suscripción IoT**](/docs/sub-activate) y comenzar a activar la suscripción de Robonomics.\n","tools":["SLS Firmware 2022.08.13 https://github.com/airalab/robonomics-hass-utils"],"fileInfo":{"path":"es/sls-gateway.md","name":"sls-gateway"}}},"context":{}}