{"hash":"aead50ac73c745bb189e936e9792a96377a793bd","data":{"doc":{"id":"2fbe5239d779b137136f6c6c20728097","title":"Connect the simplest CPS","description":"","cover_image":{"type":"image","mimeType":"image/png","src":"/assets/static/connect-simple-cps.0b85c65.6a7b51bd4f5224c6b2c70088d41e961a.png","size":{"width":1920,"height":1080},"sizes":"(max-width: 1920px) 100vw, 1920px","srcset":["/assets/static/connect-simple-cps.1b91758.6a7b51bd4f5224c6b2c70088d41e961a.png 480w","/assets/static/connect-simple-cps.3df3210.6a7b51bd4f5224c6b2c70088d41e961a.png 1024w","/assets/static/connect-simple-cps.0b85c65.6a7b51bd4f5224c6b2c70088d41e961a.png 1920w"],"dataUri":"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1920 1080' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-37569d1f4453bcef06d6a79fa0ef791c'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-37569d1f4453bcef06d6a79fa0ef791c)' width='1920' height='1080' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAkCAYAAAA5DDySAAAACXBIWXMAAAsSAAALEgHS3X78AAADRUlEQVRo3u2Y%2b0tUQRTH/RPCrH6oTK1My%2bgF/dT/0I/9EJEQpJWIFmaklq9U1PJZkgmWkpn5SNNMtF1fbWYviSDKB7au666r7XttXe9%2bmxm8cnPXxcDHYnPgcJk5M3NnPvfM3DnHZ2tgCKj6BeyD7849CAo7BpPZDCqCIGClxOl0whvFZwtZONXAA0ddAFAZU41jcHgEo8oxfPv%2bA8oxFUZGf0KjncTg0DBU42qoNRoMzbcZVSoxNT290Ifa9XqD10Lw2ey/ly3%2b5Kkz8A85hID9R/4CUFVTi5j4BDx4WImz5y%2bh%2bH4ZbqRnITUrF5m3C5CUlonryem4djMNFVVPUVhSivqmFkREX0FKZg6y84qgePeejTU3N%2bd9APx2BcM/9DDCjp/A9uAwBBAYUgBGkwkTGi374vRrarRaaCd10BsMUKnV%2bKXXz9u1mNRNEdskzGYLpqamoWNlHUwms/d6ANv/BIIv8YRNO3Yj6OB/eAZQCNuCQl3OADppqoIgPoWFOmlZmFenB/VqDxDVHYCNLhwAB8ABcAAcAAfAASwNwNNlRlrnru1im7s%2bS/V31281PohHAILkhfTWR4MZF2X1gsuiRZtUpP3Em6RYFm%2bVa32NXtYWoAHPcoQGQUajyWXRFot12ROiQZbdbsfsrIPoLGZmZlYVgkcAVNo6ZCQkroOirx/db96i7bUcHfIuyLp7IOvqQf/HT2hpa4e8uxcdnd3ILbzLQuce0nbgy1d09SpYSNzY3Iqml6/IeHL0KPrwrKERdY3NJFTuZ%2b%2bob2pmY1XXNqC0vIKF0nSs5ta2BW9c8y1AhU700eNqZN0pRGx8IjJy85CYmsEmGB4RxfIBOfnFqKl/DqVKRRb1AiVl5QiPjGL1FFxE9GUkpNwiffNZ7uD0uUjEJSbjYmwcrial4EJMHArulaJd1onKJzXIzi8i4zWycSiEdTsDqFA3VE9oYLFamYvTso24JXVTm83G1GAwMlcVXZY%2braTebidtbTMsQ2S12uBwOGAwGvHh8wBp95vZaHtqM1ssbIH0XWL%2bgD6luYS1PwRXMB/wryI9QNf1EFwNXZxX8NrfIL8IcQAcAAfAAXAAHAAHwAFwABwAB8ABbFD5Az4DlX/M7wFVAAAAAElFTkSuQmCC' /%3e%3c/svg%3e"},"contributors":["ensrationis","akru"],"translated":false,"headings":[],"subtitles":[{"depth":2,"value":"Arduino","anchor":"#arduino"},{"depth":2,"value":"AIRA client","anchor":"#aira-client"},{"depth":2,"value":"ROS","anchor":"#ros"},{"depth":2,"value":"AIRA","anchor":"#aira"}],"content":"\nIn this section we will build the simplest real cyber-physical system!\n\nWe will buy a \"wink\" from Arduino, e.g. make Arduino blink with its onboard led. The lesson is tested on Arduino Uno, but any other board with a led will do the job.\n\n> The source code of this lesson is [here](https://github.com/airalab/robonomics_tutorials/tree/master/arduino_blink).\n\n## Arduino\n\nThe firmware for the board is located in [arduino_blink/misc/arduino/arduino.ino](https://github.com/airalab/robonomics_tutorials/blob/master/arduino_blink/misc/arduino/arduino.ino). Use [Arduino IDE](https://www.arduino.cc/en/Main/Software) to load the code to your Arduino board.\n\nIn the code we subscribe for the ``/blink_led`` topic and set a callback. The type of the topic is ``Empty``, so the board waits until someone publishes to the topic and performs the LED blinking.\n\n```\n  #include <ros.h>\n  #include <std_msgs/Empty.h>\n\n  ros::NodeHandle  nh;\n\n  void blink(int led, int mil) {\n\n    digitalWrite(led, HIGH);\n    delay(mil);\n    digitalWrite(led, LOW);\n    delay(mil);\n\n  }\n\n  void messageCb( const std_msgs::Empty& toggle_msg){\n    blink(LED_BUILTIN, 500);\n    blink(LED_BUILTIN, 500);\n    blink(LED_BUILTIN, 500);\n  }\n\n  ros::Subscriber<std_msgs::Empty> sub(\"blink_led\", &messageCb );\n\n  void setup()\n  {\n    pinMode(LED_BUILTIN, OUTPUT);\n    nh.initNode();\n    nh.subscribe(sub);\n  }\n\n  void loop()\n  {\n    nh.spinOnce();\n    delay(1);\n  }\n```\n\n\n## AIRA client\n\n> You can download the latest release from [here](https://github.com/airalab/aira/releases).\n\nSet up the COM port forwarding. You should forward your `/dev/ttyUSB0` or `/dev/ttyACM0` port (depending on the system) to `COM1`. In the client `/dev/ttyS0` will represent the board. After this launch the virtual machine.\n\n## ROS\n\nWhen new liability is created it goes to `/liability/ready` topic. We have to remember the address and call `/liability/start` service to get the data from objective.\n\n```\n  def newliability(l):\n    self.liability = l.address\n    rospy.loginfo(\"Got new liability {}\".format(self.liability))\n\n    prefix = \"/liability/eth_\" + self.liability\n    rospy.Subscriber(prefix + '/blink', Empty, self.blink)\n\n    rospy.wait_for_service(\"/liability/start\")\n    rospy.ServiceProxy('/liability/start', StartLiability)(StartLiabilityRequest(address=self.liability))\n  rospy.Subscriber(\"/liability/ready\", Liability, newliability)\n```\n\nA message in the `/blink` topic come from the objective field. Have a look at [Basic usage](/docs/aira-basic-usage) page.\n\n## AIRA\n\nConnect to AIRA client via SSH as described [here](/docs/aira-connecting-via-ssh). All tutorials are pre-installed. To launch the ros package run the following command:\n\n```\n$ rosrun arduino_blink blink.py\n```\n\nAlso we need to add a rosbag file to IPFS::\n\n```\n$ ipfs add rosbag/blink.bag\n```\n\n> Before the next step you should approve XRT tokens on the Factory.\n\nOn your host system build and launch an Dapp for the lesson:\n\n```\n$ git clone https://github.com/airalab/robonomics_tutorials/\n$ cd robonomics_tutorials/arduino_blink_dapp\n$ npm i && npm run dev\n```\n\nOpen [http://localhost:8000/](http://localhost:8000/) and press \"Demand\" then \"Offer\" buttons. Wait until a new liability is created and you should see the board blinking. Congratulations on the first agent!\n"}},"context":{}}