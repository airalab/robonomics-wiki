{"hash":"feda4ec934d52b6ddee56ffa67b30f8ee1b3f99f","data":{"doc":{"id":"7f2f306ea9fed4dc72ccdc42d44842b2","title":"Connect Vacuum Cleaner","contributors":["LoSk-p","dergudzon","Leemo94"],"translated":false,"headings":[],"subtitles":[{"depth":2,"value":"Connect to Home Assistant","anchor":"#connect-to-home-assistant"}],"content":"\n## Connect to Home Assistant\n\nYou need your vacuum to be connected to Mi Home app. If you haven't done this yet press `+` button on the top right corner, find your vacuum (it must be in connecting mode via a long press of the power button) and follow instructions in the app. For more details look at the user manual of your vacuum.\n\nOpen Home Assistant web page with this address:\n```\nhttp://<raspberry_address>:8123\n```\n\nGo to `Integrations` tab, press `Add integration` and choose `Xiaomi Miio`:\n\n![integration](../images/home-assistant/integration.png)\n\nThen fill your username (or phone) and password from Mi Home account and choose your country server:\n\n![auth](../images/home-assistant/auth.png)\n\nPress `Submit` and choose your Vacuum (Robot vacuum in this example):\n\n![vacuum](../images/home-assistant/vacuum_int.png)\n\nThen we need to setup action to control Vacuum through Robonomics. For that open a configuration file on your raspberry pi:\n\n```bash\nnano /srv/homeassistant/python_scripts/config.config\n```\n\nAnd add information about vacuum to the end of the file:\n\n```\n[vacuum]\nIDS = ['vacuum.robot_vacuum']\nSEED = word word word word\n```\nWhere `vacuum.robot_vacuum` is Entity ID of the vacuum.\n\nAfter you fill the configuration file you need to get access token from Home Assistant if you don't have it yet. For that open your `profile` in the lower left corner:\n\n![profile](../images/home-assistant/profile.png)\n\nIn the end of the page find `Long-Lived Access Tokens` and press `create token`. Save it somewhere, you will not be able to see it again.\n\n![token](../images/home-assistant/token.png)\n\nNow run `create_config.py` script with your token:\n\n```bash\ncd /srv/homeassistant\npython3 python_scripts/create_config.py --token <access_token>\n```\n\nAnd restart Home Assistant:\n```bash\nsystemctl restart home-sistant@homeassistant.service\n```\n\nNow you can create datalog in your user account to command robot to Start Cleaning, to Pause or to Return to Base. The message must be encrypted, you can encrypt message with `encrypt.py` script:\n```bash\ncd /srv/homeassistant/python_scripts\nsource /srv/homeassistant/bin/activate\npython3 encrypt.py <message>\n```\nMessage format:\n- to pause: `{\"agent\": \"vacuum_start\"}`\n- to pause: `{\"agent\": \"vacuum_pause\"}`\n- to return to base: `{\"agent\": \"vacuum_return_to_base\"}`\n\n> `vacuum` in `vacuum_start` and other commands is the name of you device from config file.\n"}},"context":{}}