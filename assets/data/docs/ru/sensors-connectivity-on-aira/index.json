{"hash":"0816185e0d45bd55b51e43791d9a8400bfec4a03","data":{"doc":{"id":"887cbfea9b63e2ae6011d24fb54e7238","title":"Sensors Connectivity","contributors":["LoSk-p","Vourhey","tubleronchik"],"translated":true,"headings":[{"value":"Запуск собственного сервера Sensors Connectivity"}],"subtitles":[{"depth":1,"value":"Запуск собственного сервера Sensors Connectivity","anchor":"#запуск-собственного-сервера-sensors-connectivity"},{"depth":2,"value":"Требования","anchor":"#требования"},{"depth":2,"value":"Установка в качестве PyPi пакета","anchor":"#установка-в-качестве-pypi-пакета"},{"depth":3,"value":"Конфигурация","anchor":"#конфигурация"},{"depth":3,"value":"Запуск","anchor":"#запуск"},{"depth":2,"value":"Сборка из источников","anchor":"#сборка-из-источников"},{"depth":3,"value":"Требования","anchor":"#требования-1"},{"depth":3,"value":"Получение пакета и установка зависимостей","anchor":"#получение-пакета-и-установка-зависимостей"},{"depth":3,"value":"Документация","anchor":"#документация"},{"depth":3,"value":"Configuration","anchor":"#configuration"},{"depth":3,"value":"Запуск","anchor":"#запуск-1"},{"depth":3,"value":"Пример логов:","anchor":"#пример-логов"},{"depth":2,"value":"Устранение неполадок","anchor":"#устранение-неполадок"},{"depth":3,"value":"Python.h: No such file or directory","anchor":"#pythonh-no-such-file-or-directory"},{"depth":3,"value":"Несоответствие версий Python","anchor":"#несоответствие-версий-python"}],"content":"\nДля получения и обработки данных Sensors Robonomics Network использует модуль sensors community от Робономики. Этот модуль позволяет любому пользователю поднять свой собственный сервер для получения данных с датчиков и дальнейшей их обработки. Сейчас разработчиками запущено несколько таких серверов и любой датчик может отправлять данные на них. Запуск нескольких серверов позволяет избежать потери данных при проблемах в работе одного из них, поскольку датчики с нерабочего сервера переключатся на рабочий.\n\nСхема работы Sensors Connectivity:\n\n```\n    station1 \\                        / feeder1\n    station2 -  sensors-connectivity  - feeder2\n    station3 /                        \\ feeder3\n```\n\nSensors Connectivity представляет из себя набор станций (station1, station2...), на которые приходят различные данные, в том числе данные с датчиков по http протоколу. Но также это могут быть датчики, подключенные к компьтеру по USB или любой другой истчник данных.\n\nПолученные со станций данные обрабатываются Sensors Connectivity и переходят к фидерам (feeder1, feeder2...). Фидеры же отправляют обработанные данные пользователю. В нашем случае данные отправляются в децентрализованный IPFS канал.\n\nКарта [sensors.robonomics.network](https://sensors.robonomics.network/) это децентрализванное приложение (DApp), работающее на вашем компьютере. Оно читает данные из IPFS канала и выводит их на карту. Таким образом нет прямой связи между сервером, собирающим данные с датчиков, и картой, которую видит пользователь, передача данных между ними происходит через IPFS pubsub, что снижает нагрузку на сервера.\n\nКроме того, раз в какое-то время файл с данными за последний промежуток времени сохраняется в IPFS, а хэш этих данных далее записывается в блокчейн. Так как IPFS это контентно-адресуемая сеть, то сохранение данных в ней дает гарантию, что любое изменение в них не пройдет незамеченным, потому что адрес нужного файла содержит хэш его содержимого, который поменяется при любом изменении данных. Блокчейн используется для передачи хэша дальше пользователю, который может использовать его, чтобы получить из IPFS нужные данные (что и происходит при запросе просмотра истории на карте [sensors.robonomics.network](https://sensors.robonomics.network/)). Так как сделанную транзакцию невозможно изменить, то можно быть уверенным, что это правильный хэш.\n\nИсходный код для Sensors Connectivity доступен по [ссылке](https://github.com/airalab/sensors-connectivity). Чтобы увидеть данные со своего сервера на карте, вам нужно обратиться к команде разработки по адресу vm@multi-agent.io и отправить ipfs id своего сервера.\n\n# Запуск собственного сервера Sensors Connectivity\n\n## Требования\n\nЧтобы собрать Python пакет вам нужен IPFS daemon. Установите его следующими командами:\n\n```\nwget https://dist.ipfs.io/go-ipfs/v0.8.0/go-ipfs_v0.8.0_linux-amd64.tar.gz\ntar -xzf go-ipfs_v0.8.0_linux-amd64.tar.gz\ncd go-ipfs\nsudo bash install.sh \nipfs init\n```\nВы можете получить IPFS ID следующей командой после запуска IPFS daemon (вам нужно то, что в графе `ID`)\n\n```console\n$ ipfs id\n{\n\t\"ID\": \"QmUZxw8jsRpSx5rWkTpJokPGKvWihTrt5rbRCFXzJ4eCAP\",\n\t\"PublicKey\": \"CAASpgIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC/uMV3rLM/C+LOh2DGPo3chr+VM+vyYMKi...\n    ...\n```\n\n## Установка в качестве PyPi пакета\n\n```\npip3 install py-sr25519-bindings\npip3 install sensors-connectivity\n```\n\n### Конфигурация\n\n[Здесь](/docs/configuration-options-description/) вы можете найти статью о том, как установить правильную конфигурацию для вашего сервера.\n\n### Запуск\n\nСначала запустите IPFS Daemon:\n\n```\nipfs daemon --enable-pubsub-experiment\n```\nПосле настройки конфигурации можно запустить сервис (в другом терминале):\n\n```\nsensors_connectivity \"path/to/your/config/file\"\n```\n\nВы сможете увидеть логи в терминале и в файле `~/.logs`.\n\n## Сборка из источников\n### Требования\n\nЧтобы собрать пакет из источников вам нужен установленный [poetry](https://python-poetry.org/docs/#osx--linux--bashonwindows-install-instructions) . Для linux:\n\n```\ncurl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python -\n```\n\n### Получение пакета и установка зависимостей\n\n```\ngit clone https://github.com/airalab/sensors-connectivity\ncd sensors-connectivity\npoetry install\n```\n\n### Документация\n\nЧтобы подготовить датчик к работе с собственным сервером, пройдите инструкцию на [Robonomics Wiki](/docs/connect-sensor-to-robonomics/).\n\n### Configuration\n\n[Здесь](/docs/configuration-options-description/) вы можете найти статью о том, как установить правильную конфигурацию для вашего сервера.\n\nСкопируйте `default.json` и заполните его использую информацию из статьи.\n\nВы также можете задать файл протоколирования. По умолчанию для логгирования используется файл `logging.py`, который по умолчанию использует обработчик `console` и `file`. Обратите внимание на обработчик `file`. Шаблон хранится в файле `connectivity/config/logging_template.py`. Вы можете указать путь (`filename`), в котором будут храниться ваши логи (не забудьте создать этот каталог, если он не существует). По умолчанию путь для логов - `~/.logs`. Вы можете использовать любые другие обработчики из [library](https://docs.python.org/3.8/library/logging.html).\n\n### Запуск\n\nЗапустите IPFS Daemon:\n\n```\nipfs daemon --enable-pubsub-experiment\n```\nПосле настройки конфигурации и лог файлов можно запустить службу (в другом терминале):\n\n```\npoetry run sensors_connectivity \"path/to/your/config/file\"  \n```\nЕсли в вашем файле журнала установлен обработчик `console`, вы сможете видеть логи в консоли.\n\n### Пример логов:\n\n```\n2022-02-17 19:30:51,248 - INFO - Getting data from the stations...\n2022-02-17 19:30:51,443 - INFO - airalab-http-v0.8.0: [[], [{MAC: c8e2650f254e, Uptime: 0:00:14.010502, M: {Public: 0be87b58e87599a85dc79bf14731cc9ad547411e9b10c883e29f78fc2c67206a, geo: (53.518475,49.397178000000004), measurements: {'airtemp': -8.0, 'windang': 45.0, 'windspeed': 0.13, 'windspeedmax': 0.13, 'pm10': '', 'pm25': '', 'timestamp': 1645113602.0}}}]]\n2022-02-17 19:30:51,443 - INFO - Sending result to the feeders...\n2022-02-17 19:31:07,517 - INFO - Frontier Datalog: Data sent to Robonomics datalog and included in block 0x04baf3d81c6d31ec6f3ca3e515b9a6920666ee17cbd66f57130eaa000bad2cd4\n2022-02-17 19:31:07,519 - INFO - RobonomicsFeeder: {\"0be87b58e87599a85dc79bf14731cc9ad547411e9b10c883e29f78fc2c67206a\": {\"model\": 2, \"geo\": \"53.518475,49.397178000000004\", \"measurement\": {\"airtemp\": -8.0, \"windang\": 45.0, \"windspeed\": 0.13, \"windspeedmax\": 0.13, \"pm10\": \"\", \"pm25\": \"\", \"timestamp\": 1645113602.0}}}\n2022-02-17 19:31:07,523 - INFO - Checking data base...\n127.0.0.1 - - [17/Feb/2022 19:31:13] \"POST / HTTP/1.1\" 200 -\n2022-02-17 19:31:21,248 - INFO - Getting data from the stations...\n2022-02-17 19:31:21,429 - INFO - airalab-http-v0.8.0: [[{MAC: c8e2650f254e, Uptime: 0:00:43.818101, M: {Public: 133b761496539ab5d1140e94f644e2ef92c7ac32446dc782bfe1a768379a669a, geo: (1,200), measurements: {'pm10': 27.58, 'pm25': 15.02, 'temperature': 22.93, 'pressure': 758.0687068706872, 'humidity': 39.44, 'timestamp': 1645115473}}}], [{MAC: c8e2650f254e, Uptime: 0:00:43.996539, M: {Public: 0be87b58e87599a85dc79bf14731cc9ad547411e9b10c883e29f78fc2c67206a, geo: (53.518475,49.397178000000004), measurements: {'airtemp': -8.0, 'windang': 45.0, 'windspeed': 0.13, 'windspeedmax': 0.13, 'pm10': '', 'pm25': '', 'timestamp': 1645113602.0}}}]]\n2022-02-17 19:31:21,444 - INFO - Sending result to the feeders...\n2022-02-17 19:31:51,249 - INFO - Getting data from the stations...\n```\n\n## Устранение неполадок\n\n### Python.h: No such file or directory\n\nЕсли при выполнении команды `poetry install` вы получаете такую ошибку, вам необходимо установить заголовочные файлы и статические библиотеки для python dev. Для установки используйте ваш менеджер пакетов. Например, для `apt` вам нужно выполнить команду\n```\nsudo apt install python3-dev\n```\n> Note:\npython3-dev не охватывает все версии для python3. Для работы сервиса требуется как минимум python3.8, для этого вам может потребоваться указать версию `sudo apt install python3.8-dev`..\n\n[Здесь](https://stackoverflow.com/a/21530768) вы можете найти примеры для других менеджеров пакетов.\n\n### Несоответствие версий Python\n\nЕсли при выполнении команды `poetry install` вы получаете ошибку `SolverProblemError`, которая гласит \"The current project's Python requirement (3.6.9) is not compatible with some of the required packages Python requirement:...\", даже если у вас более старая версия python (например, python3.8), возможно, вам нужно указать версию python, которую использует poetry:\n\n```\npoetry env use python3.8\n```\n\n"}},"context":{}}