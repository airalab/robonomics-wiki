{"hash":"e70e5d83b59e22ac1f1f08820f9edc38637839ff","data":{"doc":{"id":"d786730453014ae485af64b97c6e2616","title":"Резервные службы","description":"","contributors":["tubleronchik","LoSk-p"],"headings":[],"subtitles":[{"depth":2,"value":"Создание резервной копии конфигурации Home Assistant","anchor":"#создание-резервной-копии-конфигурации-home-assistant"},{"depth":2,"value":"Восстановление конфигурации Home Assistant из резервной копии","anchor":"#восстановление-конфигурации-home-assistant-из-резервной-копии"},{"depth":2,"value":"Восстановление конфигурации Mosquitto и Zigbee2MQTT для метода установки Home Assistant Core","anchor":"#восстановление-конфигурации-mosquitto-и-zigbee2mqtt-для-метода-установки-home-assistant-core"},{"depth":2,"value":"Резервное копирование конфигурации Mosquitto и Zigbee2MQTT для метода установки Home Assistant Docker","anchor":"#резервное-копирование-конфигурации-mosquitto-и-zigbee2mqtt-для-метода-установки-home-assistant-docker"},{"depth":2,"value":"Кнопки резервного копирования","anchor":"#кнопки-резервного-копирования"}],"content":"\n**В этой статье вы узнаете, как создавать резервные копии конфигурации Home Assistant и восстанавливать ее при необходимости. Для создания резервных копий вызывается служба, которая генерирует защищенный архив с файлами конфигурации. Также служба добавляет конфигурацию Mosquitto brocker и Zigbee2MQTT в резервную копию, если они существуют. Затем эта служба добавляет архив в IPFS и сохраняет полученный CID в цифровом двойнике Robonomics.**\n## Создание резервной копии конфигурации Home Assistant\n\nСоздание резервной копии позволяет легко восстановить конфигурацию Home Assistant в случае сбоя.\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmZN5LfWR4XwAiZ3jEcw7xbCnT81NsF5XE3XFaNhMm5ba1', type:'mp4'}]\" />\n\n<robo-wiki-note type=\"warning\" title=\"WARNING\">\n\nДля резервного копирования и восстановления конфигурации необходимо использовать **пользовательский IPFS-шлюз**, такой как Pinata. Без него ваша резервная копия будет храниться только на вашем локальном узле IPFS, что может помешать восстановлению конфигурации Home Assistant в случае сбоя локального узла.\n\n</robo-wiki-note>\n\n1. В веб-интерфейсе Home Assistant перейдите в `Developer Tools` -> `Services`. Найдите `Robonomics: Save Backup to Robonomics` и нажмите `CALL SERVICE`.\n\n2. Дождитесь появления уведомления `Backup was updated in Robonomics` в разделе `Notification`.\n\n<robo-wiki-note type=\"warning\" title=\"WARNING\">\n\nНе пытайтесь создавать резервную копию или восстанавливать конфигурацию непосредственно после загрузки Home Assistant и интеграции Robonomics. Пожалуйста, **подождите примерно 5 минут**, чтобы завершить начальную настройку.\n\n</robo-wiki-note>\n\nАргументы службы:\n- **Полная резервная копия** (по умолчанию: False) - добавляет базу данных в резервную копию, чтобы сохранялась история состояний сущностей.\n- **Путь к файлу паролей mosquitto** (по умолчанию: `/etc/mosquitto`) - Если вы использовали методы установки Ядро Home Assistant или Docker и у вас нет стандартного пути к Mosquitto brocker, вы должны изменить этот параметр. *Не требуется для Home Assistant OS или Superviser*.\n\n## Восстановление конфигурации Home Assistant из резервной копии\n\nДля восстановления конфигурации вам понадобится установленный Home Assistant и интеграция Robonomics. \n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmNcJpHWWuZzwNCQryTw5kcki49oNTjEb8xvnfffSYfRVa', type:'mp4'}]\" />\n\n<robo-wiki-note type=\"warning\" title=\"WARNING\">\n\nЧтобы успешно восстановить конфигурацию в Home Assistant Core и методах установки Docker, вам необходимо выполнить дополнительные настройки, описанные в конце страницы.\n\n</robo-wiki-note>\n\n1. Установите Home Assisntant с интеграцией Robonomics (если еще не установлено), следуя шагам из статьи для [желаемого метода установки](https://wiki.robonomics.network/docs/robonomics-smart-home-overview/#start-here-your-smart-home).\n\n2. [Настройте интеграцию Robonomics](https://wiki.robonomics.network/docs/robonomics-hass-integration), используя **те же сиды**, которые вы использовали в предыдущей конфигурации Robonomics. Если ваша подписка закончилась, [возобновите ее](https://wiki.robonomics.network/docs/sub-activate).\n\n3. В веб-интерфейсе Home Assistant перейдите в `Develop2er To1ols` -> `Services`. Найдите `Robonomics: Restore from the Backup in Robonomics` и нажмите `CALL SERVICE`. Перейдите на страницу `Overview`, чтобы проверить состояние вашей резервной копии.\n\n4. После восстановления Home Assistant автоматически перезагрузится. Если по какой-либо причине Home Assistant не перезагружается, вы можете проверить статус восстановления, отслеживая состояние сущности `robonomics.backup`. Если статус - `restored`, вам нужно будет вручную перезапустить Home Assistant, перейдя в `Settings` > `System` и нажав кнопку `RESTART`, расположенную в правом верхнем углу.\n\n5. Если ваша резервная копия включает конфигурацию Zigbee2MQTT или Mosquitto, вам нужно перезапустить эти сервисы, чтобы включить новую конфигурацию. Вы можете сделать это вручную, перезапустив сервисы по отдельности, или просто перезапустив компьютер Home Assistant, чтобы убедиться, что все сервисы перезапущены.\n\nАргументы службы:\n- **путь к файлу паролей mosquitto** (по умолчанию: `/etc/mosquitto`) - Если вы использовали методы установки Home Assistant Core или Docker и у вас нет пути по умолчанию к брокеру Mosquitto, вы должны изменить этот параметр. *Не требуется для Home Assistant OS или Superviser*.\n- **Путь к конфигурации Zigbee2MQTT** (по умолчанию: `/opt/zigbee2mqtt`) - Если вы использовали методы установки Home Assistant Core или Docker и у вас нет пути по умолчанию к Zigbee2MQTT, вы должны изменить этот параметр. *Не требуется для Home Assistant OS или Superviser*.\n\n## Восстановление конфигурации Mosquitto и Zigbee2MQTT для метода установки Home Assistant Core\n\nЕсли резервная копия включает конфигурацию Mosquitto или Zigbee2MQTT, во время процесса восстановления они будут размещены в пути по умолчанию или в указанном в аргументах пути. Однако, если вы установили интеграцию Robonomics в существующий Home Assistant Core *(не из предустановленного образа Robonomics)*, пользователь `homeassistant` может не иметь доступа к этому пути.\n\nЧтобы восстановить конфигурацию Mosquitto и Zigbee2MQTT, вам нужно предоставить пользователю `homeassistant` необходимые права на чтение:\n```bash\nsudo chmod a+w /opt/zigbee2mqtt /etc/mosquitto\n```\n\n## Резервное копирование конфигурации Mosquitto и Zigbee2MQTT для метода установки Home Assistant Docker\n\nЧтобы создать резервные копии конфигураций Mosquitto и Zigbee2MQTT из контейнера Docker, вам нужно создать тома для соответствующих конфигураций. Это можно сделать, запустив контейнер Home Assistant с дополнительными аргументами:\n\n```bash\ndocker run -d \\\n  --name homeassistant \\\n  --privileged \\\n  --restart=unless-stopped \\\n  -e TZ=MY_TIME_ZONE \\\n  -v /PATH_TO_YOUR_CONFIG:/config \\\n  -v /etc/mosquitto:/etc/mosquitto \\\n  -v /etc/mosquitto:/opt/zigbee2mqtt \\\n  --network=host \\\n  ghcr.io/home-assistant/home-assistant:stable\n```\n\nили внести изменения в ваш файл `compose.yaml`:\n\n```yaml\nversion: '3'\nservices:\n  homeassistant:\n    container_name: homeassistant\n    image: \"ghcr.io/home-assistant/home-assistant:stable\"\n    volumes:\n      - /PATH_TO_YOUR_CONFIG:/config\n      - /etc/localtime:/etc/localtime:ro\n      - /etc/mosquitto:/etc/mosquitto\n      - /etc/mosquitto:/opt/zigbee2mqtt\n    restart: unless-stopped\n    privileged: true\n    network_mode: host\n```\n<robo-wiki-note type=\"note\" title=\"Note\">\n\nОбратите внимание, что пути по умолчанию для конфигураций Mosquitto и Zigbee2MQTT - `/etc/mosquitto` и `/opt/zigbee2mqtt` соответственно. Однако эти пути могут отличаться в зависимости от вашей конкретной настройки.\n\n</robo-wiki-note>\n\n## Кнопки резервного копирования\n\nПомимо использования сервисов для работы с резервными копиями, вы можете упростить процесс, используя кнопки `button.create_backup` и `button.restore_from_backup` из интеграции Robonomics. Эти кнопки вызывают соответствующие сервисы с параметрами по умолчанию (кнопка резервного копирования создает резервную копию без истории).\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/Qmc1fexYaJMsK6ch6JhjL6aqnAwqYNAzo5nEwYgDpnp4gj', type:'mp4'}]\" />\n\nЧтобы добавить кнопки на вашу панель управления, выполните следующие действия:\n\n1. Нажмите на три точки в правом верхнем углу панели управления.\n2. Выберите `Edit Dashboard`.\n3. Нажмите кнопку `Add Card` в правом нижнем углу.\n4. Выберите карточку Entities`.\n5. В поле Entities` найдите сущности button.create_backup и button.restore_from_backup.\n6. Нажмите `Save`, чтобы добавить сущности на карточку.\n7. Завершите редактирование, нажав кнопку `Done` в правом верхнем углу.","tools":["Robonomics Home Assistant Integration 1.4.2 https://github.com/airalab/homeassistant-robonomics-integration"],"fileInfo":{"path":"ru/backup-services.md","name":"backup-services"}}},"context":{}}