{"hash":"43cdadfbe0ed6cb2a1300f58105ff56ac7d0dbc2","data":{"doc":{"id":"8f088856820b34852c5b233b590a7c2c","title":"Как обновить версию узла Robonomics Collator","description":"","contributors":["Leemo94"],"headings":[],"subtitles":[{"depth":2,"value":"","anchor":"#необходимые-команды"},{"depth":2,"value":"","anchor":"#изменение-базы-данных-kusama-relay-chain-без-установленного-базового-пути"}],"content":"\nРекомендуется прочитать следующие статьи перед прочтением этого поста: [\"Как построить узел Collator\"](/docs/how-to-build-collator-node) и [\"Как запустить Robonomics Collator\"](/docs/how-to-launch-the-robonomics-collator).\n\nВ этой статье приведены команды, необходимые для обновления узла Robonomics collator (работающего на Ubuntu), а также приведен пример после этого.\n\n## **Необходимые команды**\n\n0. Прежде чем начать, рекомендуется войти в систему под учетной записью `root`, если нет, то рекомендуется использовать:\n\n<code-helper copy>\n\n```shell\nsudo su -\n```\n\n</code-helper>\n\n1. Остановите службу Robonomics:\n\n<code-helper copy>\n\n```shell\nsystemctl stop robonomics.service\n```\n\n</code-helper>\n\n2. Удалите предыдущую версию Robonomics (убедитесь, что вы находитесь в правильном каталоге):\n\n<code-helper copy>\n\n```shell\nrm -f robonomics.X.X.X-ubuntu-x86_64.tar.gz\n```\n\n</code-helper>\n\n3. Получите [последний релиз](https://github.com/airalab/robonomics/releases) версии Robonomics:\n\n<code-helper copy>\n\n```shell\nwget https://github.com/airalab/robonomics/releases/vX.X.X/.....\n```\n</code-helper>\n\n\n4. Извлеките файл:\n\n<code-helper copy>\n\n```shell\ntar -xf robonomics-X.X.X-x86_64-unknown-linux.gnu.tar.gz\n```\n</code-helper>\n\n5. Переместите файл:\n\n<code-helper copy>\n\n```shell\nmv robonomics /usr/local/bin/\n```\n</code-helper>\n\n<robo-wiki-note type=\"note\">\n\nВам нужно переместить этот файл в правильный каталог, в который вы установили узел Robonomics)\n\n</robo-wiki-note>\n\n6. Запустите Robonomics:\n\n<code-helper copy>\n\n```shell\nsystemctl start robonomics.service\n```\n</code-helper>\n\nПример обновления узла коллатора до Robonomics v1.8.4:\n\n<code-helper>\n\n```shell\nsudo su -\ncd /home/admin\nsystemctl stop robonomics.service\nrm -f robonomics-1.7.3-x86_64-unknown-linux-gnu.tar.gz\nwget https://github.com/airalab/robonomics/releases/download/v1.8.4/robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\ntar -xf robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\nmv robonomics /usr/local/bin/\nsystemctl start robonomics.service\n\n```\n</code-helper>\n\n## **Изменение базы данных Kusama Relay Chain без установленного базового пути**\n\nИногда определенные снимки Kusama Relay Chain вызывают ошибки в вашем узле. Это часто приводит к остановке работы вашего узла. Пример ошибки, вызванной поврежденной базой данных Relay Chain:\n\n<code-helper>\n\n```shell\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] GRANDPA voter error: could not complete a round on disk: Database\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] Essential task `grandpa-voter` failed. Shutting down service.\nDec 08 19:14:32 ns3159483 robonomics[1019836]: Error: Service(Other(\"Essential task failed.\"))\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\nec 08 19:14:33 ns3159483 robonomics[1022922]: Error: Service(Client(Backend(\"Invalid argument: Column families not opened: col12, col11, col10, col9, col8, col7, col6, col5, col4, col3, col2, col1, col0\")))\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\n```\n</code-helper>\n\nЧтобы исправить эту ошибку, вы должны удалить существующую базу данных Kusama Relay Chain (скорее всего RocksDb) и заменить ее другой базой данных, такой как ParityDb. Выполните следующие команды:\n\n1. Найдите каталог узла Robonomics и проверьте файлы:\n\n<code-helper>\n\n```shell\ncd /home/robonomics/\nls -a\n```\n</code-helper>\n\n2. Убедитесь, что вы видите каталог polkadot, а затем перейдите в каталог chains:\n\n<code-helper>\n\n```shell\ncd /polkadot/chains/\nls -a\n```\n</code-helper>\n\n3. Удалите каталог `ksmcc3`:\n\n<code-helper copy>\n\n```shell\nrm -r ksmcc3\n```\n</code-helper>\n\n4. Создайте новый каталог `ksmcc3`:\n\n<code-helper>\n\n```shell\nmkdir ksmcc3\nchown -R robonomics:robonomics ksmcc3\ncd ksmcc3\n```\n\n</code-helper>\n\n5. Теперь вам нужно загрузить новый снимок. В этом примере используется сильно усеченный снимок ретрансляционной цепи, но вы можете заменить его на любой предпочитаемый снимок.\n\n<code-helper copy>\n\n```shell\nwget wget https://snaps.sik.rocks/ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n6. Пока снимок загружается, откройте новую сессию и отредактируйте ваш сервисный файл:\n\n\n<code-helper copy>\n\n```shell\nsudo nano /etc/systemd/system/robonomics.service\n```\n\n</code-helper>\n\nИзмените строки в сервисном файле, относящиеся к базе данных и усечению:\n\n<code-helper copy>\n\n```shell\n  --database=paritydb \\\n  --state-pruning=100 \\\n  --blocks-pruning=100 \\\n  --execution=Wasm\n```\n\n</code-helper>\n\n  \nИспользуйте `Ctrl + S`, а затем `Ctrl + X`, чтобы сохранить и выйти из сервисного файла.\n\n7. Теперь вам нужно перезагрузить ваш демон.\n\n<code-helper copy>\n\n```shell\nsystemctl daemon-reload\n```\n</code-helper>\n\n\n8. К этому времени, в вашей другой сессии, надеюсь, новая база данных загрузилась, поэтому извлеките файл:\n\n<code-helper copy>\n\n```shell\ntar -xvzf ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n9. После завершения распаковки выполните следующее:\n\n<code-helper copy>\n\n\n```shell\nchown -R robonomics:robonomics paritydb\n```\n\n</code-helper>\n\n10. Теперь вы можете запустить сервис, отслеживать возможные ошибки и проверить, что он соединяется как с ретрансляционной цепью, так и с парачейном.\n\n\n<code-helper copy>\n\n\n```shell\nsystemctl start robonomics && journalctl -fu robonomics\n```\n</code-helper>","tools":[],"fileInfo":{"path":"ru/how-to-update-collator-node-version.md","name":"how-to-update-collator-node-version"}}},"context":{}}