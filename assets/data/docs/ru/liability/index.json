{"hash":"b83d5f18369768fde049882ec26a1d23ed762a87","data":{"doc":{"id":"87cbbb4087aa49ec1fb5f29b522ca88e","title":"Liability","description":"","contributors":["PaTara43"],"translated":false,"headings":[],"subtitles":[{"depth":2,"value":"Theory Overview","anchor":"#theory-overview"},{"depth":3,"value":"Negotiations","anchor":"#negotiations"},{"depth":3,"value":"Signatures","anchor":"#signatures"},{"depth":2,"value":"Create Liability","anchor":"#create-liability"},{"depth":3,"value":"Preparations","anchor":"#preparations"},{"depth":3,"value":"1. Create three accounts and add funds to them","anchor":"#1-create-three-accounts-and-add-funds-to-them"},{"depth":3,"value":"1. Navigate to Developer -> Extrinsics","anchor":"#1-navigate-to-developer---extrinsics"},{"depth":3,"value":"2. Choose liability -> create from the dropdown list of possible extrinsics","anchor":"#2-choose-liability---create-from-the-dropdown-list-of-possible-extrinsics"},{"depth":3,"value":"3. Submit transaction","anchor":"#3-submit-transaction"},{"depth":3,"value":"4. Review your liability in the events","anchor":"#4-review-your-liability-in-the-events"},{"depth":3,"value":"5. Storage exploring","anchor":"#5-storage-exploring"},{"depth":2,"value":"Reports","anchor":"#reports"},{"depth":3,"value":"1. Navigate to extrinsics, liability -> finalize(report)","anchor":"#1-navigate-to-extrinsics-liability---finalizereport"},{"depth":3,"value":"2. Explore reports","anchor":"#2-explore-reports"},{"depth":3,"value":"3. Check balances","anchor":"#3-check-balances"}],"content":"\n**To turn robots into economic agents one needs a contract tool for this. Meet Liability - Robonomics pallet implementing\ncontracts between parachain accounts!**\n\n## Theory Overview\n\nBack on the Ethereum there was quite a complicated structure of liability interaction. You can get acquainted with it \n[here](/docs/robonomics-how-it-works). Nowadays things are a bit easier with Kusama!\n\n### Negotiations\n\nTo sign a contract the two sides need to negotiate first. This may be done several ways, including \n[IPFS PubSub ](https://blog.ipfs.tech/25-pubsub/) or Robonomics PubSub. A sample of Python code using Robonomics PubSub is \npresented [here](https://multi-agent-io.github.io/robonomics-interface/usage.html#pubsub). \n\nOffer and demand are messages containing two main characteristics of a contract: **job description** and **price**. Message\nformat is to be designed by user for each specific application. It is not that important in the negotiations process to follow\na strict format rule. The possible flow is presented in the picture below.\n\n<robo-wiki-picture src=\"liability/negotiations.jpg\" />\n\n<robo-wiki-note type=\"warning\" title=\"PubSub\">\n\n  Note that PubSub is an open protocol, so no sensible data should be transferred. For this you should use other protocols.\n\n</robo-wiki-note>\n\n\n### Signatures\n\nWhen negotiations are successfully over, each side needs to sign its so-called agreement named a signature. This is a \nmessage containing job description and price **in a specific format** signed with a private key of the account. There is a \n[Python tool](https://multi-agent-io.github.io/robonomics-interface/modules.html#robonomicsinterface.Liability.sign_liability) for that as well.\n - Job description is called **technics**. This is a launch-like 32 bytes long string which may be an encoded IPFS CID.\n - Price is called **economics**. This is an XRT decimal - Weiner. 1 Weiner = 10**-9 XRT.\n\n<robo-wiki-note type=\"note\" title=\"32 bytes\">\n\n  One may obtain an [IPFS](https://ipfs.tech/) CID formatted in a proper way with the [Python library](https://multi-agent-io.github.io/robonomics-interface/modules.html#robonomicsinterface.utils.ipfs_qm_hash_to_32_bytes).\n  When using the `sign_liability` function, no need to transform the hash, it will be done automatically.\n\n</robo-wiki-note>\n\nFollowing the coffee example:\n\n1. The task is a JSON\n```json\n{\"task\": \"make_espresso\", \"description\": \"Make one cup of espresso\"}\n```\n2. Its IPFS CID is `QmP17mWKtQtq2Gq6qZAggPRrho3sVjQGBpXZ8KZiQ57FDi`\n3. So the **technics** (transformed CID) is `0x09daaa8055722a6894951b1273e807f8a46628efeec46805f0228ace230bd5a9` \n4. **Economics** is `1.5 XRT`.\n\nWhen signed, it's time to create a liability! This may be done by one of the sides (either promisee or promisor) or by a \n3rd-party account of a so-called provider.\n\n## Create Liability\n\n### Preparations\n\nAs have been mentioned earlier, at least two sides are involved in the process. For this example, let's use three and make\na separated provider for this. Assume that the negotiations took place somehow already.\n\n### 1. Create three accounts and add funds to them\n\n<robo-wiki-picture src=\"liability/balances.jpg\" />\n\nHere we have supplied the provider with 100 XRT to sign liability extrinsics, promisee was given 2 XRT to pay for the work.\nPromisor wasn't granted any funds (except for an existential deposit of at least 1 mXRT).\n\n### 1. Navigate to Developer -> Extrinsics\n\n<robo-wiki-picture src=\"liability/extrinsics.jpg\" />\n\n### 2. Choose liability -> create from the dropdown list of possible extrinsics\n\nAlso choose an account you want to submit the extrinsic with. Fill in all the parameters.\n\n<robo-wiki-picture src=\"liability/create.jpg\" />\n\n<robo-wiki-note type=\"note\" title=\"Signatures\">\n\n  Since provider is used here, no need to know seeds of the participants. Only their signatures needed.\n\n</robo-wiki-note>\n\n### 3. Submit transaction\n\n<robo-wiki-picture src=\"liability/submit.jpg\" />\n\n### 4. Review your liability in the events\n\nFor this, navigate to `Network -> Explorer` and find a list of events on the right. Click a triangle icon to expand.\n\n<robo-wiki-picture src=\"liability/new-liability.jpg\" />\n\n<robo-wiki-note type=\"note\" title=\"Hash\">\n\n  The hash may be transformed to an IPFS CID with the same \n  [Python tool](https://multi-agent-io.github.io/robonomics-interface/modules.html#robonomicsinterface.utils.ipfs_32_bytes_to_qm_hash).\n\n</robo-wiki-note>\n\n### 5. Storage exploring\n\nYou may also explore some characteristics of the liabilities in storage module `liability`.\n\n<robo-wiki-picture src=\"liability/storage-liability.jpg\" />\n\n<robo-wiki-note type=\"note\" title=\"Next Index\">\n\n  The `Next Index` storage function shows the latest liability index +1, so even though it's `1`, liability `0` is explored.\n\n</robo-wiki-note>\n\n## Reports\n\nImage that a coffee has been made and now the coffee machine needs to report it somehow. That's where liability reports\ncome into scene. As a proof of labour the account adds another IPFS CID as a report content when finalizing the existing\nliability. This again requires a signature of the promisor.\n\n<robo-wiki-note type=\"note\" title=\"Report signature\">\n\n  Message signed contains of the existing liability index and the report IPFS CID encoded in 32 bytes representation. Once again,\n  the [Python tool](https://multi-agent-io.github.io/robonomics-interface/modules.html#robonomicsinterface.Liability.sign_report) can help to sign the report.\n\n</robo-wiki-note>\n\nKeeping with the coffee machine example:\n\n1. Report is a JSON\n```json\n{\"report\": \"Coffee made! Time to execute - 80 seconds.\"}\n```\n2. Its IPFS CID is `QmeXCrBuv6cw825JJfSWqNVv28AyjJZW9KReN9wcLQjfCm`\n3. So the **payload** (transformed CID) is `0xf06f2394f55537a5f37d63fd72bfbef50e9f60ea9e0e34224e455afae27a97a2` \n4. **Index** is `0` it's the existing liability index.\n\n### 1. Navigate to extrinsics, liability -> finalize(report)\n\nFill in the parameters and submit extrinsic. Again, this may be done by a 3rd-party account. \n\n<robo-wiki-picture src=\"liability/report.jpg\" />\n\n<robo-wiki-note type=\"warning\" title=\"Existential deposit\">\n\n  Pay attention that the promisor account should not be \"dead\" - it should have the existential deposit of at least 1 mXRT.\n\n</robo-wiki-note>\n\nSign and submit the report. When done, you can explore it in the events.\n\n<robo-wiki-picture src=\"liability/new-report.jpg\" />\n\n### 2. Explore reports\n\nYou can also observe the report in the storage. Go to `Developer -> Storage` and choose `liability` from the dropdown list.\n\n<robo-wiki-picture src=\"liability/storage-report.jpg\" />\n\n### 3. Check balances\n\nOn the picture it's shown that now the promisor has got the \"salary\". Economical relationship happened!\n\n<robo-wiki-picture src=\"liability/balances-2.jpg\" />\n\n\n<robo-wiki-note type=\"note\" title=\"Verifying\">\n\n  As for now there is no way to verify the job is done, so as soon as the promisor reports, the tokens are transferred to its account.\n  The verify feature is to be added in the future.\n\n</robo-wiki-note>","tools":["Robonomics 2.3.0 https://github.com/airalab/robonomics","robonomics_interface 1.3.5 https://github.com/Multi-Agent-io/robonomics-interface"],"fileInfo":{"path":"ru/liability.md","name":"liability"}}},"context":{}}