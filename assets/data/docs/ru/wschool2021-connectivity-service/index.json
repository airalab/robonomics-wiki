{"hash":"b79e9d6821fa0d666337564f5ef21889faecefc9","data":{"doc":{"id":"594be39ba5f64870ee24748a04b9071e","title":"Lesson 5, Connectivity","description":"","contributors":["vourhey"],"translated":false,"headings":[],"subtitles":[{"depth":2,"value":"IoT as a Multiple Pie","anchor":"#iot-as-a-multiple-pie"},{"depth":2,"value":"Device Software","anchor":"#device-software"},{"depth":2,"value":"What is Connectivity?","anchor":"#what-is-connectivity"},{"depth":2,"value":"Comparison of AWS and Robonomics Connectivity","anchor":"#comparison-of-aws-and-robonomics-connectivity"},{"depth":2,"value":"Installing Connectivity on Aira","anchor":"#installing-connectivity-on-aira"},{"depth":3,"value":"Requirements","anchor":"#requirements"},{"depth":2,"value":"Connect Sensor to Connectivity","anchor":"#connect-sensor-to-connectivity"},{"depth":3,"value":"Requirements","anchor":"#requirements-1"},{"depth":2,"value":"Practice","anchor":"#practice"},{"depth":3,"value":"Trajectory 1. Flash a sensor ESP + SDS011","anchor":"#trajectory-1-flash-a-sensor-esp--sds011"},{"depth":3,"value":"Trajectory 2. Launch Connectivity","anchor":"#trajectory-2-launch-connectivity"}],"content":"\n## IoT as a Multiple Pie\n\n* Device Software\n    * FreeRTOS\n    * ESP/Arduino\n    * Single-board computers (RPi, LattePanda etc)\n* Connectivity\n    * IoT Hub\n    * IoT Manager\n* Analytics Services\n    * AWS\n    * Google Cloud IoT Core\n    * ThingsBoard\n\nAs a rule, most are not interested in sensors and servers, but data analytics.\nTo get it, you need to decide which device to use, how to work with it and where to connect\n\n## Device Software\n\nConsider the example of a home weather station. It is necessary to collect data on air pollution (SDS011), temperature and humidity (BME). The ESP8266 microcontroller can handle this task.\n\nRequirements:\n\n* Correctly read data from sensors\n* Have a unique identifier\n* Transfer data to a known server\n* Provide digital signature of data (optional)\n\nYou can find the current firmware [here](https://github.com/LoSk-p/sensors-software/tree/366b19bf447a5fc19220ef89eab0f2440f8db1c2)\n\n## What is Connectivity? \n\nIn the IoT world, connectivity refers to the connection of various IoT devices to the Internet to send data and / or control the device.\n\nWell-known architectural solutions can be roughly divided into 3 groups:\n\n* Fully decentralized. For example, devices are connected by a mesh network. Not suitable for wide area networks due to high hardware requirements\n* Centralized. For example, AWS. Provides a single entry point and ease of connection, but there is a high risk of failure in case of server problems\n* Hybrid. For example, [Robonomics Connectivity](https://github.com/airalab/sensors-connectivity). Provides an address for devices on a \"local\" network and publishes data to a distributed IPFS message channel\n\n## Comparison of AWS and Robonomics Connectivity\n\n| Management services \t| AWS                               \t|               Robonomics              \t|\n|---------------------\t|-----------------------------------\t|---------------------------------------\t|\n| Transaction type    \t| Technical                         \t| Technical and economic                \t|\n| Security            \t| IT-company cloud control          \t| Polkadot and Ethereum                 \t|\n| Protocol            \t| HTTPS, MQTT                       \t| IPFS, Robonomics                      \t|\n| Ecosystem           \t| Private                           \t| Shared                                \t|\n| Access to DeFi      \t| No                                \t| Yes                                   \t|\n| Costs               \t| Pushing data - $1-2 a sensor      \t| Pushing data - $0                     \t|\n|                     \t| Shadow         - from $10 a month \t| Digital Twin    - $0,01 a transaction \t|\n\n## Installing Connectivity on Aira\n\nhttps://www.youtube.com/watch?v=JbBNMHAzJKM\n\n### Requirements\n\n* [VirtualBox 6.1](https://www.virtualbox.org/wiki/Downloads) and above\n* [Aira OS ova image](https://static.aira.life/ova/airaos-21.03_robonomics-winter-school.ova)\n\nImport Aira image in VirtualBox as described [here](/docs/aira-installation-on-vb/)\n\nSet up a connection over [SSH](/docs/aira-connecting-via-ssh/)\n\nWhen everything is set and you successfully log in via SSH, let's clone the main package and build it \n\n```\ngit clone https://github.com/airalab/sensors-connectivity\ncd sensors-connectivity\ngit checkout v0.9\nnix build -f release.nix\n```\n\nNow let's create a copy of the default configuration file for later usage. \nTo learn about all the options check [this article](/docs/configuration-options-description/) out.\nThen launch the package with `roslaunch`\n\n```\ncp config/default.json config/my.json\nsource result/setup.zsh\nroslaunch sensors_connectivity agent.launch config:=$PWD/config/my.json\n```\n\n## Connect Sensor to Connectivity\n\nhttps://www.youtube.com/watch?v=yxqxBk-6bpI\n\n### Requirements\n\n* [Nova SDS011](https://aqicn.org/sensor/sds011) sensor \n* [Yarn Packet Manager](https://yarnpkg.com/getting-started/install)\n\nNow let's connect a real sensor, forward USB port to the virtual machine, set up a map and look at our own measurements\n\nFirst, stop the Aira OS if it was running and add a corresponding USB device\n\n![VB USB Forwarding](../images/vb_forward_usb.jpg)\n\nStart the VM, connect via SSH and set `comstation/port` option according to your USB device in the VM. Also enable `comstation` and set your latitude and longitude. In the end `config/my.json` should look like this:\n\n```\n{\n   \"general\":{\n      \"publish_interval\":30\n   },\n   \"comstation\":{\n      \"enable\":true,\n      \"port\":\"/dev/ttyUSB0\",\n      \"work_period\":0,\n      \"geo\":\"59.944917,30.294558\",\n      \"public_key\":\"\"\n   },\n   \"httpstation\":{\n      \"enable\":false,\n      \"port\":8001\n   },\n   \"mqttstation\": {\n      \"enable\": false,\n      \"host\": \"connectivity.robonomics.network\",\n      \"port\": 1883\n   },\n   \"luftdaten\":{\n      \"enable\":false\n   },\n   \"robonomics\":{\n      \"enable\":true,\n      \"ipfs_provider\":\"/ip4/127.0.0.1/tcp/5001/http\",\n      \"ipfs_topic\":\"airalab.lighthouse.5.robonomics.eth\"\n   },\n   \"datalog\":{\n      \"enable\":false,\n      \"path\":\"\",\n      \"suri\":\"\",\n      \"remote\":\"wss://substrate.ipci.io\",\n      \"dump_interval\":3600,\n      \"temporal_username\":\"\",\n      \"temporal_password\":\"\"\n   },\n   \"dev\":{\n      \"sentry\":\"\"\n   }\n}\n```\n\n> If you don't have a real sensor, you can use `sensors-connectivity/utils/virtual-sensor.py` script to emulate one\n> \n> Enable `HTTPStation` and disable `COMStation` by changing the configuration file as:\n> ```\n> {\n>    \"general\":{\n>       \"publish_interval\":30\n>    },\n>    \"comstation\":{\n>       \"enable\":false,\n>       \"port\":\"/dev/ttyUSB0\",\n>       \"work_period\":0,\n>       \"geo\":\"59.944917,30.294558\",\n>       \"public_key\":\"\"\n>    },\n>    \"httpstation\":{\n>       \"enable\":true,\n>       \"port\":8001\n>    },\n>    ...\n> }\n> ```\n>\n> and launching `utils/virtual-sensor.py` in a dedicated terminal in the VM\n\nSave the file and launch connectivity from `sensors-connectivity` folder:\n\n```\nsource result/setup.zsh\nroslaunch sensors_connectivity agent.launch config:=$PWD/config/my.json\n```\n\nYou should see first measurements in the console output\n\nLook for your IPFS ID in the VM. It appears right after booting the image or via `ipfs id` command. We will need it later.\n\nNow let's set up our own instance of the map. On your laptop (not in the VM) clone [this](https://github.com/airalab/sensors.robonomics.network) repository and build the app:\n\n```\ngit clone https://github.com/airalab/sensors.robonomics.network\ncd sensors.robonomics.network\nyarn install\n```\n\nEdit `src/agents.json` file and put your IPFS ID. For example:\n\n```\n[\n  \"12D3KooWSCFAD3Lpew1HijniE6oFTuo4jsMwHzF87wNnXkpCRYWn\"\n]\n```\n\nLaunch the map:\n\n```\nyarn serve\n```\n\nGo to [http://localhost:8080/](http://localhost:8080/) or the address yarn gave you and look for the sensor.\n\n## Practice\n\n### Trajectory 1. Flash a sensor ESP + SDS011\n\nRequirements:\n\n* ESP8266\n* At least one of sensors SDS011, BME280, HTU21D\n\nUse the [instruction](https://wiki.robonomics.network/docs/connect-sensor-to-robonomics/) to connect a sensor to Robonomics Connectivity. \n\nCheck that your sensor appears on our [map](https://sensors.robonomics.network/#/).\n\n### Trajectory 2. Launch Connectivity\n\nRequirements:\n\n* ROS\n* Python\n* Nix (optional)\n\nBuild and launch [sensors-connectivity](https://github.com/airalab/sensors-connectivity#get-a-package-and-build)\n\n> How it build, install [here](https://wiki.robonomics.network/docs/iot-sensors-connectivity/) and configure [here](https://wiki.robonomics.network/docs/configuration-options-description/)\n\nGeneral scheme of the package:\n\n```\n    station1 \\                        / feeder1\n    station2 -  sensors-connectivity  - feeder2\n    station3 /                        \\ feeder3\n```\n\nThe choice is proposed to implement either a new station, for example, a random number generator, or a new feeder, for example, displaying a string on the screen.\n\nInterface `IStation` [here](https://github.com/airalab/sensors-connectivity/blob/master/src/stations/istation.py#L73).\n\nInterface `IFeeder` [here](https://github.com/airalab/sensors-connectivity/blob/master/src/feeders/ifeeder.py#L5)\n\n","tools":[],"fileInfo":{"path":"ru/wschool2021-connectivity-service.md","name":"wschool2021-connectivity-service"}}},"context":{}}