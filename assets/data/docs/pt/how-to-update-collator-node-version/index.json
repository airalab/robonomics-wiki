{"hash":"6049b68e007bd8fa4054505bb4c1089344ab6865","data":{"doc":{"id":"e8dea4f4be5a5e59cc91d1b42214c2a8","title":"Como atualizar a versão do nó Robonomics Collator","description":"","contributors":["Leemo94"],"headings":[],"subtitles":[{"depth":2,"value":"","anchor":"#comandos-necessários"},{"depth":2,"value":"","anchor":"#alterando-o-banco-de-dados-da-cadeia-de-retransmissão-kusama-sem-definir-um-caminho-base"}],"content":"\nRecomenda-se ler os seguintes artigos antes de ler esta postagem: [\"Como construir um nó Collator\"](/docs/how-to-build-collator-node) e [\"Como lançar o Robonomics Collator\"](/docs/how-to-launch-the-robonomics-collator).\n\nEste artigo contém os comandos necessarios para atualizar um nó collator Robonomics (executando no Ubuntu) e também dá um exemplo posteriormente.\n\n## **Comandos necessários**\n\n0. Antes de começar, é recomendado que você esteja logado como `root`, caso contrário, recomendo que você use:\n\n<code-helper copy>\n\n```shell\nsudo su -\n```\n\n</code-helper>\n\n1. Pare o serviço Robonomics:\n\n<code-helper copy>\n\n```shell\nsystemctl stop robonomics.service\n```\n\n</code-helper>\n\n2. Remova a versão anterior do Robonomics (certifique-se de estar no diretório correto):\n\n<code-helper copy>\n\n```shell\nrm -f robonomics.X.X.X-ubuntu-x86_64.tar.gz\n```\n\n</code-helper>\n\n3. Obtenha a [versão mais recente](https://github.com/airalab/robonomics/releases) do Robonomics:\n\n<code-helper copy>\n\n```shell\nwget https://github.com/airalab/robonomics/releases/vX.X.X/.....\n```\n</code-helper>\n\n\n4. Extraia o arquivo:\n\n<code-helper copy>\n\n```shell\ntar -xf robonomics-X.X.X-x86_64-unknown-linux.gnu.tar.gz\n```\n</code-helper>\n\n5. Mova o arquivo:\n\n<code-helper copy>\n\n```shell\nmv robonomics /usr/local/bin/\n```\n</code-helper>\n\n<robo-wiki-note type=\"note\">\n\nVocê precisa mover este arquivo para o diretório correto onde você instalou o nó Robonomics)\n\n</robo-wiki-note>\n\n6. Inicie o Robonomics:\n\n<code-helper copy>\n\n```shell\nsystemctl start robonomics.service\n```\n</code-helper>\n\nExemplo de atualização do nó collator para Robonomics v1.8.4:\n\n<code-helper>\n\n```shell\nsudo su -\ncd /home/admin\nsystemctl stop robonomics.service\nrm -f robonomics-1.7.3-x86_64-unknown-linux-gnu.tar.gz\nwget https://github.com/airalab/robonomics/releases/download/v1.8.4/robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\ntar -xf robonomics-1.8.4-x86_64-unknown-linux-gnu.tar.gz\nmv robonomics /usr/local/bin/\nsystemctl start robonomics.service\n\n```\n</code-helper>\n\n## **Alterando o banco de dados da cadeia de retransmissão Kusama sem definir um caminho base**\n\nHá momentos em que certos instantâneos da cadeia de retransmissão Kusama causam erros no seu nó. Isso geralmente faz com que o nó pare de funcionar. Exemplo de erro causado por um banco de dados corrompido da cadeia de retransmissão:\n\n<code-helper>\n\n```shell\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] GRANDPA voter error: could not complete a round on disk: Database\nDec 08 19:14:31 ns3159483 robonomics[1019836]: 2022-12-08 19:14:31 [Relaychain] Essential task `grandpa-voter` failed. Shutting down service.\nDec 08 19:14:32 ns3159483 robonomics[1019836]: Error: Service(Other(\"Essential task failed.\"))\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:32 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\nec 08 19:14:33 ns3159483 robonomics[1022922]: Error: Service(Client(Backend(\"Invalid argument: Column families not opened: col12, col11, col10, col9, col8, col7, col6, col5, col4, col3, col2, col1, col0\")))\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Main process exited, code=exited, status=1/FAILURE\nDec 08 19:14:33 ns3159483 systemd[1]: robonomics.service: Failed with result 'exit-code'.\n```\n</code-helper>\n\nPara corrigir esse erro, você deve remover o banco de dados existente da cadeia de retransmissão Kusama (provavelmente RocksDb) e substituí-lo por outro banco de dados, como ParityDb. Execute os seguintes comandos:\n\n1. Encontre o diretório do nó Robonomics e verifique os arquivos:\n\n<code-helper>\n\n```shell\ncd /home/robonomics/\nls -a\n```\n</code-helper>\n\n2. Confirme que você vê o diretório polkadot e, em seguida, navegue até o diretório chains:\n\n<code-helper>\n\n```shell\ncd /polkadot/chains/\nls -a\n```\n</code-helper>\n\n3. Exclua o diretório `ksmcc3`:\n\n<code-helper copy>\n\n```shell\nrm -r ksmcc3\n```\n</code-helper>\n\n4. Crie um novo diretório `ksmcc3`.\n\n<code-helper>\n\n```shell\nmkdir ksmcc3\nchown -R robonomics:robonomics ksmcc3\ncd ksmcc3\n```\n\n</code-helper>\n\n5. Agora você precisa baixar um novo instantâneo. Este exemplo usa um instantâneo da cadeia de retransmissão fortemente podado, mas você pode trocá-lo por qualquer instantâneo que preferir.\n\n<code-helper copy>\n\n```shell\nwget wget https://snaps.sik.rocks/ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n6. Enquanto o instantâneo está sendo baixado, abra uma nova sessão e edite seu arquivo de serviço:\n\n\n<code-helper copy>\n\n```shell\nsudo nano /etc/systemd/system/robonomics.service\n```\n\n</code-helper>\n\nModifique as linhas dentro do arquivo de serviço que se referem ao banco de dados e poda:\n\n<code-helper copy>\n\n```shell\n  --database=paritydb \\\n  --state-pruning=100 \\\n  --blocks-pruning=100 \\\n  --execution=Wasm\n```\n\n</code-helper>\n\n  \nUse `Ctrl + S` e depois `Ctrl + X` para salvar e sair do arquivo de serviço.\n\n7. Agora você precisa recarregar seu daemon.\n\n<code-helper copy>\n\n```shell\nsystemctl daemon-reload\n```\n</code-helper>\n\n\n8. Neste momento, em sua outra sessão, esperamos que o novo banco de dados tenha sido baixado, então extraia o arquivo:\n\n<code-helper copy>\n\n```shell\ntar -xvzf ksm_pruned.tar.gz\n```\n\n</code-helper>\n\n9. Após a descompactação ser concluída, execute o seguinte:\n\n<code-helper copy>\n\n\n```shell\nchown -R robonomics:robonomics paritydb\n```\n\n</code-helper>\n\n10. Agora você pode iniciar o serviço, monitorá-lo em busca de erros e verificar se ele está se conectando tanto à cadeia de retransmissão quanto à parachain.\n\n\n<code-helper copy>\n\n\n```shell\nsystemctl start robonomics && journalctl -fu robonomics\n```\n</code-helper>","tools":[],"fileInfo":{"path":"pt/how-to-update-collator-node-version.md","name":"how-to-update-collator-node-version"}}},"context":{}}