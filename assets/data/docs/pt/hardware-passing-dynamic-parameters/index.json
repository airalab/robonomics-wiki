{"hash":"fd5d0a5f3aa1c3e6f4368684b3f72c24a1a4a9b2","data":{"doc":{"id":"ef267f6769700152a5a65937b87bc588","title":"Passing dynamic parameters","description":"","cover_image":{"type":"image","mimeType":"image/png","src":"/assets/static/hardware-connect-sensor.0b85c65.1814f8f97dac2a3505944e25797662e1.png","size":{"width":1920,"height":1080},"sizes":"(max-width: 1920px) 100vw, 1920px","srcset":["/assets/static/hardware-connect-sensor.1b91758.1814f8f97dac2a3505944e25797662e1.png 480w","/assets/static/hardware-connect-sensor.3df3210.1814f8f97dac2a3505944e25797662e1.png 1024w","/assets/static/hardware-connect-sensor.0b85c65.1814f8f97dac2a3505944e25797662e1.png 1920w"],"dataUri":"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1920 1080' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-f42852cdb4d4338b243cad88182f3195'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-f42852cdb4d4338b243cad88182f3195)' width='1920' height='1080' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAkCAYAAAA5DDySAAAACXBIWXMAAAsSAAALEgHS3X78AAADaUlEQVRo3u2YWU9TQRTH%2bQhGUR9UBFQExbglPvkdfPTJ6BPEKIgsYd8RCCAgIERAUBACKCCKILLJvrm%2byI7IUlq2lrbsXP7eM7ZQFiuJrWlwTnJy75yZOTP3d2cmc47ZAStbkJpbnsTeI8dhbX8RSpUKJIIgwFCyuroKUxSz/eKHk1qdvrAFAMnwyCh6%2bwcwODSMzu4eDA2PYGDwB6SycfT29WNkVAKJVIo%2bTZvBoSFMTk2t9aF6uVxhshDM9lmcYB9/5eo1WNieheWp8xsA5Ba8gIunL9KeZOO6wy0kPUpHQFgkQiJjEHH/AfxDI%2bATFAavwFBk5eYjISUVRa/ewNHZDcER0YiKS0RzWwfztbKyYnoAzI/awMLuHOwvXcYhG3tYijB0AcwolRiTytgfp78plckgG5%2bAXKHAiESCablcUy/D%2bMSkWDcOlUqNyckpTLDyBJRKlemuALb/RQh7xZWw5/AxWJ/5D88AgnDQ2m7LGUCTJhUE7VNYs%2bmWBY2u6lGTXgFa3Q7AbhcOgAPgADgADoAD4AB%2bD0DfZUbXtrndZrtu%2bU/v%2bur/KQBBZ1C69VEws0WZXdgwSbLrXqO1t0atLGuCIrJTf23dut/1ttuP9%2btpiBvmjrYABTyGiAHm5ud3POnFxUXMi%2b2NHV/oBUBSUVUjhsSFaG5tR31TCyqqa1FVW4ea%2bgbU1DWg4%2bNnlJa/Q1NrG1rbPyAlPRMNza0sF1BZ8x7JaRl4XVaBzq4ePEx9jNjEZOYrNTOLte3/PsjsxWIITT7KK6vxratb7POWheCNLW1sPNK6xmY2Bs2D7EZfASTPi0vwNCcPkbEJuOvph/CYOPiFhLNY/4bjbZYPiIpPRH7hSxSVlMLZwxtB4VEoKS1Hdl4B3H0D4eTuhU9fviIjOweZz3Lh5hMA78BQODi5wjsojOUTyI%2brtz/LK9CYZRWVrN9NFw94BYQgOj4Jjnfc4Bt8j%2bUnaE7aLWJUAEtLS5CMSaGenWVxPpVpKdMSnZubY6qYmWH1VLewsIBZ0TYvPpeXl1mZ6tl%2b1%2bx9hWKG%2bSB/09NyqNWzoqpZO/JL/SiHQGXyQz7IrhLbqMS50fy058TfbgP9h6AB8wG6h6mhcwxGPQRNWY2%2bAvhFiAPgADgADoAD4AA4AA6AA%2bAAOAAOYJfKTxcTiZpoRXsRAAAAAElFTkSuQmCC' /%3e%3c/svg%3e"},"contributors":["ensrationis","akru"],"translated":true,"headings":[],"subtitles":[{"depth":2,"value":"Arduino","anchor":"#arduino"},{"depth":2,"value":"ROS","anchor":"#ros"},{"depth":2,"value":"AIRA","anchor":"#aira"}],"content":"\nIn [previous](/docs/connect-simple-cps/) example we discussed how to create a simple CPS with Arduino. Our first CPS is able to do only one task: to blink a led. We suggest you to get through the first lesson. Now let's expand the example and teach our board to blink blue or red led depending on objective parameter.\n\n> The source code of this lesson is [here](https://github.com/airalab/robonomics_tutorials/tree/master/arduino_with_args).\n\n\n## Arduino\n\nThe only difference in Arduino source code is instead of subscribing to one topic now we subscribe to `/blink_red` and `/blink_blue` topics\n\n```c\n  #include <ros.h>\n  #include <std_msgs/Empty.h>\n\n  ros::NodeHandle nh;\n\n  void blink(int led, int mil) {\n\n    digitalWrite(led, HIGH);\n    delay(mil);\n    digitalWrite(led, LOW);\n    delay(mil);\n\n  }\n\n  void blinkRedCb(const std_msgs::Empty& msg) {\n    blink(13, 500);\n    blink(13, 500);\n    blink(13, 500);\n  }\n\n  void blinkBlueCb(const std_msgs::Empty& msg) {\n    blink(12, 500);\n    blink(12, 500);\n    blink(12, 500);\n  }\n\n  ros::Subscriber<std_msgs::Empty> subRed(\"blink_red\", &blinkRedCb);\n  ros::Subscriber<std_msgs::Empty> subBlue(\"blink_blue\", &blinkBlueCb);\n\n  void setup()\n  {\n    pinMode(13, OUTPUT);\n    pinMode(12, OUTPUT);\n\n    nh.initNode();\n    nh.subscribe(subRed);\n    nh.subscribe(subBlue);\n  }\n\n  void loop()\n  {\n    nh.spinOnce();\n    delay(1);\n  }\n```\n\n<!-- Here is the diagram of all connections:\n\n.. image:: ../img/6.png\n  :alt: Arduino schema\n  :align: center -->\n\n\n## ROS\n\nWe can pass arguments via objective which points to rosbag file. Have a look at `blink.py` script. The main difference is `blink()` method:\n\n```python\ndef blink(self, data):\n  if data.data == \"blue\":\n      rospy.loginfo(\"Blinking blue...\")\n      self.blink_blue.publish(Empty())\n\n  if data.data == \"red\":\n      rospy.loginfo(\"Blinking red...\")\n      self.blink_red.publish(Empty())\n\n  rospy.wait_for_service('/liability/finish')\n  fin = rospy.ServiceProxy('/liability/finish', FinishLiability)\n  fin(FinishLiabilityRequest(address=self.liability, success=True))\n  rospy.loginfo(\"Finished\")\n```\n\nNow `/blink` topic has a `String` type. You can find prepared rosbags in `rosbag` folder.\n\n## AIRA\n\nConnect to AIRA client via SSH as described [here](/docs/aira-connecting-via-ssh/). Do not forget to add `COM1` port in settings. Run the following command:\n\n```\n$ rosrun arduino_with_args blink.py\n```\n\nAlso we need to add rosbag files to IPFS:\n\n```\n$ ipfs add rosbag/blink_blue.bag\n$ ipfs add rosbag/blink_red.bag\n```\n\n**Before the next step you should approve XRT tokens on the Factory.**\n\nThe last step is to build Dapp and launch. Take a look at the previous [lesson](/docs/connect-simple-cps/). To make Arduino blink the blue led send blue demand and blue offer messages. For the red one send corresponding messages.\n\nThat's it! Now you are able to pass dynamic parameters to your cyber-physical system agent!"}},"context":{}}