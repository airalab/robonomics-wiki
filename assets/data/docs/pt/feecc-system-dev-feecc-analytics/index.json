{"hash":"6aecd251eafd09e46c3628f8c5f662af95c38fd7","data":{"doc":{"id":"cf95e9f94de00f87c509845227ab6a4b","title":"Feecc Аналитика для разработчиков","description":"","contributors":["timofeev41"],"translated":false,"headings":[],"subtitles":[{"depth":2,"value":"Основная информация","anchor":"#основная-информация"},{"depth":2,"value":"Основные эндпоинты (по группам)","anchor":"#основные-эндпоинты-по-группам"},{"depth":3,"value":"Работа с сертификатами: /api/v1/passports","anchor":"#работа-с-сертификатами-apiv1passports"},{"depth":4,"value":"GET /","anchor":"#get-"},{"depth":4,"value":"GET /types","anchor":"#get-types"},{"depth":4,"value":"POST /","anchor":"#post-"},{"depth":4,"value":"DELETE /{internal_id}","anchor":"#delete-internal_id"},{"depth":4,"value":"GET /{internal_id}","anchor":"#get-internal_id"},{"depth":4,"value":"POST /{internal_id}/serial","anchor":"#post-internal_idserial"},{"depth":4,"value":"POST /{internal_id}/revision","anchor":"#post-internal_idrevision"},{"depth":4,"value":"POST /{internal_id}/revision/cancel","anchor":"#post-internal_idrevisioncancel"},{"depth":3,"value":"Работа с ОТК: /api/v1/tcd","anchor":"#работа-с-отк-apiv1tcd"},{"depth":4,"value":"GET /protocols","anchor":"#get-protocols"},{"depth":4,"value":"GET /protocols/types","anchor":"#get-protocolstypes"},{"depth":4,"value":"GET /protocols/pending","anchor":"#get-protocolspending"},{"depth":4,"value":"POST /protocols/{internal_id}/approve","anchor":"#post-protocolsinternal_idapprove"},{"depth":4,"value":"DELETE /protocols/{internal_id}","anchor":"#delete-protocolsinternal_id"}],"content":"\nВ этом руководстве поговорим о разработке сервисов на базе бекенда Feecc Analytics\n\n> Предполагается, что вы уже разобрались с запуском бекенда системы Feecc Аналитика. Если еще нет, обратитесь к [этому руководству](/docs/feecc-system-deploy-feecc-analytics)\n\n\n## Основная информация\n\nПроект написан на языке Python (фреймворк FastAPI). В качестве дополнительной базы данных используется MongoDB, для иммутабельности и валидации данных IPFS и Robonomics Datalog\n\nХотите внести свой вклад? PR соответствующие всем [guidelines](https://github.com/Multi-Agent-io/contribution-guidelines) приветствуются.\n\n## Основные эндпоинты (по группам)\n\nТут описаны исключительно эндпоинты (и группы эндпоинтов), содержащие необычное поведение. Для ознакомления с остальными, обратитесь к Swagger по адресу бекенда добавив к нему `/docs`.\n\n### Работа с сертификатами: /api/v1/passports\n\n#### GET /\n\nЭндпоинт для получения списка сертификатов выпущеных изделий\n\nАргументы:\n\n- `page` - номер страницы\n- `items` - количество элементов на странице\n- `sort_by_date` - сортировка по дате выпуска (`asc`/`desc`)\n- `status` - статус сертификата (`production`, `built`, `revision`, `approved`, `finalized`)\n- `name` - строка для фильтрации по названию изделия, short_url, uuid\n- `date` - строка для фильтрации по дате выпуска (в формате datetime)\n- `types` - строка для фильтрации по типу изделия. Возможна фильтрация по множественным типам, но в формате: `\"[type1,type2,type3...typeN]\"`\n\nПолучаемые данные:\n\n- `status_code` - статус запроса\n- `detail` - детали ответа\n- `count` - общее количество сертификатов, соответствующих параметрам фильтрации\n- `data` - список сертификатов в формате:\n\n  ```json\n  {\n    schema_id: str,\n    uuid: str,\n    internal_id: str,\n    passport_short_url: str/null,\n    passport_ipfs_cid: str/null,\n    is_in_db: bool/null,\n    featured_in_int_id: str/null,\n    biography: Array/null,\n    components_internal_ids: Array<str>/null,\n    model: str/null,\n    date: datetime,\n    type: str/null,\n    parential_unit: str/null,\n    serial_number: str/null,\n    status: str/null,\n    txn_hash: str/null,\n  }\n  ```\n\n#### GET /types\n\nПолучение списка всех типов изделий\n\nПолучаемые данные:\n\n- `status_code` - статус запроса\n- `detail` - детали ответа\n- `types` - список всех типов изделий\n\n\n#### POST /\n\nЭндпоинт для создания нового сертификата\n\nАргументы:\n\n- `passport` - сертфикат в формате\n\n  ```json\n  {\n    schema_id: str,\n    uuid: str,\n    internal_id: str,\n    passport_short_url: str/null,\n    passport_ipfs_cid: str/null,\n    is_in_db: bool/null,\n    featured_in_int_id: str/null,\n    biography: Array/null,\n    components_internal_ids: Array<str>/null,\n    model: str/null,\n    date: datetime,\n    type: str/null,\n    parential_unit: str/null,\n    serial_number: str/null,\n    status: str/null,\n    txn_hash: str/null,\n  }\n  ```\n\n#### DELETE /{internal_id}\n\nУдаление сертификата из системы по внутреннему номеру\n\nАргументы:\n\n- `internal_id` - внутренний номер сертификата в формате EAN13\n\n\n#### GET /{internal_id}\n\nПолучение данных сертификата из системы по внутреннему номеру\n\nАргументы:\n\n- `internal_id` - внутренний номер сертификата в формате EAN13\n\nПолучаемые данные:\n\n- `status_code` - статус запроса\n- `detail` - детали ответа\n- `passport` - данные сертификата в формате:\n\n  ```json\n  {\n    schema_id: str,\n    uuid: str,\n    internal_id: str,\n    passport_short_url: str/null,\n    passport_ipfs_cid: str/null,\n    is_in_db: bool/null,\n    featured_in_int_id: str/null,\n    biography: Array/null,\n    components_internal_ids: Array<str>/null,\n    model: str/null,\n    date: datetime,\n    type: str/null,\n    parential_unit: str/null,\n    serial_number: str/null,\n    status: str/null,\n    txn_hash: str/null,\n  }\n  ```\n\n#### POST /{internal_id}/serial\n\nОбновление серийного номера и статуса сертификата по внутреннему номеру \n\nАргументы:\n\n- `internal_id` - внутренний номер сертификата в формате EAN13\n- `serial_number` - серийный номер\n\n\n#### POST /{internal_id}/revision\n\nEndpoint для отправки текущего сертификата на доработку по выбранным производственным этапам.\nБудут созданы пустые копии этих этапов. Статус сертификата изменится на \"revision\".\n\nАргументы:\n\n- `internal_id` - внутренний номер сертификата в формате EAN13\n- `stages_ids` - array id каждого этапа, который нуждается в доработке\n\n#### POST /{internal_id}/revision/cancel\n\nEndpoint для отмены доработки для выбранных этапов.\nЕсли это единственный этап, отправленный на доработку, текущий сертификат изменит свой статус на \"built\", в противном случае статус не поменяется\n\nАргументы:\n\n- `internal_id` - внутренний номер сертификата в формате EAN13\n- `stage_id` - id этапа, доработку которого нужно отменить\n\n### Работа с ОТК: /api/v1/tcd\n\n#### GET /protocols\n\nЭндпоинт для получения списка протоколов ОТК\n\nАргументы:\n\n- `page` - номер страницы\n- `items` - количество элементов на странице\n- `sort_by_date` - сортировка по дате выпуска (`asc`/`desc`)\n- `status` - статус протокола (\"Первая стадия испытаний пройдена\", \"Вторая стадия испытаний пройдена\", \"Протокол утверждён\")\n- `name` - строка для фильтрации по названию протокола или серийному номеру (той части, которая находится в системе)\n- `date` - строка для фильтрации по дате создания (в формате datetime)\n\n#### GET /protocols/types\n\nЭндпоинт для получения списка возможных статусов протоколов\n\nПолучаемые данные:\n\n- `status_code` - статус запроса\n- `detail` - детали ответа\n- `data` - список всех статусов\n\n#### GET /protocols/pending\n\nЭндпоинт для получения номеров протоколов, которые нуждаются в утверждении (протоколы, выпущенные более 2х дней назад и не имеющие статуса \"протокол утвержден\")\n\nПолучаемые данные:\n\n- `status_code` - статус запроса\n- `detail` - детали ответа\n- `count` - количество протоколов, нуждающихся в утверждении\n- `pending` - список id всех протоколов, нуждающихся в утверждении\n\n\n#### POST /protocols/{internal_id}/approve\n\nЭндпоинт для утверждения протокола (если устройство точно прошло ВСЕ проверки), отправки сертификата в ipfs и robonomics datalog (если включена опция `USE_DATALOG` и указан путь до `Feecc IPFS Gateway`)\n\nАргументы:\n\n- `internal_id` - внутренний номер сертификата (не протокола)\n\n\n#### DELETE /protocols/{internal_id}\n\nЭндпоинт для удаления протокола. Если вы хотите изменить уже утвержденный протокол, необходимо удалить старый\n\nАргументы:\n\n- `internal_id` - внутренний номер сертификата\n\n","tools":[],"fileInfo":{"path":"pt/feecc-system-dev-feecc-analytics.md","name":"feecc-system-dev-feecc-analytics"}}},"context":{}}