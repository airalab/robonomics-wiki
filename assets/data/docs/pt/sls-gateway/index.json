{"hash":"3f5dbcf25038fb82d4541254c2b3842511271503","data":{"doc":{"id":"e219fcf1435850d8a8f3dbd4acb0be91","title":"Robonomics SLS Gateway","description":"","contributors":["LoSk-p","Fingerling42","nakata5321"],"headings":[],"subtitles":[{"depth":2,"value":"Firmware","anchor":"#firmware"},{"depth":3,"value":"Solucionando Problemas","anchor":"#solucionando-problemas"},{"depth":2,"value":"Configuração","anchor":"#configuração"},{"depth":2,"value":"Emparelhando o SLS com o MQTT","anchor":"#emparelhando-o-sls-com-o-mqtt"},{"depth":2,"value":"Conectar Dispositivos","anchor":"#conectar-dispositivos"}],"content":"\n**Neste artigo, você configurará o Robonomics SLS Gateway. Você instalará o software necessário para o gateway, o configurará e o conectará ao Home Assistant.**\n\n<robo-wiki-picture src=\"home-assistant/sls_gateway.png\" />\n\n## Firmware\n\nPrimeiro, você precisa instalar o firmware do microcontrolador do gateway. Prepare o gateway configurando as chaves `1` e `3` na parte inferior do SLS Gateway para `ON`, as outras devem estar `OFF`.\n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-13.gif\" />\n\nConecte o gateway ao seu Raspberry Pi através da porta USB tipo-C no gateway.\n\n<robo-wiki-picture src=\"home-assistant/sls-rpi.gif\" />\n\nClone o repositório com o firmware para o seu Raspberry Pi:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\ngit clone https://github.com/airalab/robonomics-hass-utils.git\n```\n\n</code-helper>\n\nVá para `robonomics-hass-utils/esp_firmware/linux`. Para atualizar o gateway SLS, você precisa executar os scripts `Clear` e `Flash_16mb`.\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\ncd robonomics-hass-utils/esp_firmware/linux\nsudo chmod +x Clear.sh\nsudo chmod +x Flash_16mb.sh\n./Clear.sh\n./Flash_16mb.sh\n```\n\n</code-helper>\n\n### Solucionando Problemas\n\nSe você estiver enfrentando problemas ao atualizar o firmware do gateway, você precisa seguir etapas adicionais:\n\n1. Certifique-se de ter o módulo pySerial instalado:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\npip install pyserial\n```\n</code-helper>\n\n2. Dê ao seu usuário direitos de acesso à porta USB e reinicie o computador:\n\n<code-helper additionalLine=\"rasppi_username@rasppi_hostname\">\n\n```shell\nsudo usermod -a -G dialout $USER\nsudo reboot\n```\n</code-helper>\n\n3. Em alguns casos, é necessário alterar a configuração de largura de banda no script para atualizar o firmware. Abra o script `Flash_16mb.sh` com o editor `nano` e altere o parâmetro de velocidade de transmissão de `921600` para um valor menor (por exemplo, `115200`).\n\n## Configuração\n\n1. Desconecte o SLS Gateway do computador. Configure as chaves na parte de trás do gateway para a posição correta. As chaves `5` (RX Zigbee para ESP) e `6` (TX Zigbee para ESP) devem estar na posição `ON`, as outras devem estar `OFF`. \n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-56.gif\" />\n\n2. Conecte o cabo de alimentação tipo-C. A luz indicadora no centro deve ficar verde.\n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-connect.gif\" />\n\n3. Na primeira inicialização, o gateway começará a compartilhar Wi-Fi com o SSID `zgw****`. Conecte-se a esta rede. Tenha em mente que o sinal pode ser fraco, então é melhor manter o gateway SLS mais próximo do seu computador. \n\n<robo-wiki-picture src=\"home-assistant/sls-gateway-wifi.gif\" />\n\n4. Se a conexão for bem-sucedida, a interface web será aberta (ou você pode encontrá-la no endereço 192.168.1.1). \n\n5. Você verá a página `Wi-Fi Settings`. Selecione sua rede Wi-Fi e insira a senha. Pressione o botão `Apply`. O gateway reiniciará e se conectará à sua rede Wi-Fi. \n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmSht6roENzrV6oqsQ1a5gp6GVCz54EDZdPAP8XVh9SCwH', type:'mp4'}]\" />\n\n6. Encontre o IP local do gateway SLS para acessar a interface web. Para encontrá-lo, você pode usar o [aplicativo móvel Fing](https://www.fing.com/products) ou a [ferramenta de linha de comando nmap](https://vitux.com/find-devices-connected-to-your-network-with-nmap/). O nome do gateway deve ser parecido com este: `zgw****`. Abra a interface web do gateway colando o IP do gateway em um navegador.\n\n7. Vá para `Setting` -> `Hardware` e verifique se as configurações estão iguais à imagem. Corrija as configurações, se necessário, e clique no botão `Save`:\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmeSksMxU9xkvvK7f81WDAYULiMFokK7P7KDVYEjv2MHjn', type:'mp4'}]\" />\n\nA tabela com os valores necessários:\n\n| Field                    | Value              |\n|--------------------------|:-------------------|\n| Zigbee module            | TI                 |\n| Zigbee UART RX           | 22                 |\n| Zigbee UART TX           | 23                 |\n| Zigbee RST Pin           | 18                 |\n| Zigbee BSL Pin           | 19                 |\n| Service Button Pin       | 33 (pullUP - true) |\n| Number addressable leds  | 0                  |\n| Led Red (or addr)        | 21                 |\n| Led Green                | 5                  |\n| Led Blue                 | 27                 |\n| I2C SDA                  | 255                |\n| I2C SCL                  | 255                |\n\n8. Em seguida, reinicie o gateway. Escolha `Actions` -> `Reboot system` no canto superior direito.\n\n9. Verifique se o gateway está funcionando corretamente na janela de informações do Zigbee. O DeviceState deve ser `OK`.\n\n10. Configure a adição automática de dispositivos ao Home Assistant. Vá para  `Zigbee` -> `Config` e escolha `Home Assistant MQTT Discovery` e `Clear States`. Salve as alterações e **reinicie** o gateway SLS.\n\n<robo-wiki-note type=\"warning\">\n\nSe você já tiver um gateway SLS ativo em sua casa e estiver configurando outro, eles entrarão em conflito. Para resolver esse problema, você precisa alterar o canal no novo dispositivo. Para fazer isso, vá para `Zigbee` -> `Config` e altere o canal para outro (por exemplo, canal 15).\n\n</robo-wiki-note>\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmVZMB1xQeB6ZLfSR6aUrN6cRSF296s8CMJt7E2jBJ5MjZ', type:'mp4'}]\" />\n\n## Emparelhando o SLS com o MQTT\n\nApós configurar o SLS Gateway, você precisa conectar o SLS Gateway ao Home Assistant. Abra a interface web do SLS Gateway e vá para `Settings/Link` -> `MQTT Setup`:\n\n\nAdicione o endereço do seu broker (endereço do Raspberry Pi com o Home Assistant na rede local, você pode encontrá-lo com o [aplicativo móvel Fing](https://www.fing.com/products) ou a [ferramenta de linha de comando nmap](https://vitux.com/find-devices-connected-to-your-network-with-nmap/)), porta (padrão é `1883`), nome de usuário e senha do seu broker (que você criou anteriormente) e o nome do tópico (você pode escolher qualquer um). Além disso, o endereço IP do Raspberry Pi deve ser estático. Clique em `Enable` e `Retain states`.\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/QmdNKDqwwy87VQEDDVsX5kpaDQm9wKKPEJUNJnhnjx6e5y', type:'mp4'}]\" />\n\nSalve as alterações. Agora, os dispositivos serão mostrados automaticamente no Home Assistant.\n\n## Conectar Dispositivos\n\nConecte seus dispositivos indo para `Zigbee` -> `Join`. Coloque seus sensores no modo de emparelhamento, a maneira mais comum de alternar um dispositivo para o modo de conexão é segurar seu botão de energia ou ligá-los/desligá-los 5 vezes. Pressione o botão `Enable Join` para iniciar a busca por dispositivos Zigbee. Você verá sensores ativos.\n\n<robo-wiki-picture src=\"home-assistant/switch-device.gif\" />\n\n<robo-wiki-video autoplay loop controls :videos=\"[{src: 'https://cloudflare-ipfs.com/ipfs/Qmdq3PBNY88QbYYqakwSLG2vn3mVUom3w3wsSWfTd1pzJA', type:'mp4'}]\" />\n\n\nAgora você pode ir para a seção [**Assinatura IoT**](/docs/sub-activate) e começar a ativar a assinatura Robonomics.\n","tools":["SLS Firmware 2022.08.13 https://github.com/airalab/robonomics-hass-utils"],"fileInfo":{"path":"pt/sls-gateway.md","name":"sls-gateway"}}},"context":{}}