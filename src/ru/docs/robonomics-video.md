---
title: Сервис видео Robonomics
contributors: [nakata5321]
---

Эта статья показывает, как добавить IP-камеру в Home Assistant и отправить видео на веб-сервис Robonomics.

Чтобы подключить камеру к Home Assistant, вам нужно знать ее IP-адрес и создать локальную учетную запись камеры для подключения к потоку RTSP.

{% roboWikiNote {type: "warning"}%} Поскольку это делается по-разному для каждой камеры, этот процесс не рассматривается в данной статье.
{% endroboWikiNote %}

Требования:
- IP-камера
- Настроенная локальная учетная запись камеры
- IP-адрес камеры
- Настроенный Home Assistant

{% roboWikiNote {type: "warning"}%} В данной статье предполагается, что у вас есть обычная IP-камера без опций RTZ (поворот, наклон, увеличение). Если у вас камера с опциями RTZ, проверьте статью ["Камера с опциями RTZ"](docs/ptz-camera). И затем вернитесь ко второму шагу здесь. {% endroboWikiNote %}

## Подключение камеры

Сначала вам нужно узнать URL для потока RTSP камеры.
Для этого попробуйте ввести следующий запрос в Интернете: "<ИМЯ КАМЕРЫ> поток RTSP".
URL потока должен начинаться с `rtsp://<IP-адрес>...`.

В этой статье используется камера "Tapo", и путь потока - `rtsp://<IP-адрес>/stream1`.

Откройте Home Assistant и перейдите в "Настройки" -> "Устройства и сервисы". Нажмите кнопку "ДОБАВИТЬ ИНТЕГРАЦИЮ" и начните вводить интеграцию "Общая камера". Выберите ее.

{% roboWikiPicture {src:"docs/home-assistant/generic.jpg", alt:"hass"} %}{% endroboWikiPicture %}

В окне конфигурации предоставьте следующую информацию:
- URL источника потока - URL потока RTSP камеры
- Имя пользователя - укажите имя пользователя вашей локальной учетной записи камеры
- Пароль - укажите пароль для вашей локальной учетной записи камеры

{% roboWikiPicture {src:"docs/home-assistant/genericconf.jpg", alt:"genericconf"} %}{% endroboWikiPicture %}

Прокрутите вниз настройки и нажмите кнопку "Отправить".

В окне предварительного просмотра активируйте флажок "Это изображение выглядит хорошо." и нажмите кнопку "Отправить". Затем - "Готово".

{% roboWikiPicture {src:"docs/home-assistant/preview-camera.jpg", alt:"preview-camera"} %}"} %}{% endroboWikiPicture %}

### Добавление на панель управления

Кроме того, вы можете добавить поток на свою панель управления. Для этого перейдите на панель управления и создайте новую карточку "Picture Glance". Далее следуйте этим шагам:
- введите желаемый "Заголовок"
- удалите данные из "Пути к изображению"
- выберите камеру в "Сущности камеры"
- в "Вид камеры" выберите "live", чтобы уменьшить задержку

И сохраните.

{% roboWikiPicture {src:"docs/home-assistant/camera_picture_glance.jpg", alt:"camera_picture_glance"} %}{% endroboWikiPicture %}


## Проверка папки медиа

Прежде чем отправить видео на сервис Robonomics Video, видео должно быть сохранено в папке, и Home Assistant должен иметь к ней доступ.
Самый простой вариант в этом случае - использовать медиа-пак, в котором Home Assistant хранит все медиафайлы.

- Если вы используете HAOS или предустановленное изображение, ваш Home Assistant **уже имеет папку Media**.
- Если вы используете Home Assistant Core, вам следует перейти в папку `.homeassistant` и создать в ней папку `media`.
- Если вы используете Home Assistant Docker, добавьте строку ` -v /ПУТЬ_К_ВАШИМ_МЕДИА:/media \` в команду Docker.

Чтобы убедиться, что все настроено правильно, перейдите на вкладку "Медиа" -> "локальные медиа" в вашем Home Assistant.
Вы должны увидеть пустую папку (без ошибок):

{% roboWikiPicture {src:"docs/home-assistant/media-folder.jpg", alt:"media-folder"} %}{% endroboWikiPicture %}

## Вызов сервиса

Чтобы отправить видео на Robonomics, вам следует вызвать специальный сервис в Home Assistant.
В этой статье это делается вручную, но вы можете создать для этого автоматизацию.

Для этого перейдите в "Инструменты разработчика" -> "Сервисы" и найдите "Robonomics: Сохранить запись в Robonomics".

{% roboWikiPicture {src:"docs/home-assistant/robonomics-service.jpg", alt:"robonomics-service"} %}{% endroboWikiPicture %}

В "Цели" выберите сущность вашей камеры.
В "Путь для сохранения записи" вы должны указать абсолютный путь к папке, где Home Assistant может сохранить видео:
- Для предустановленного изображения - `/home/homeassistant/.homeassistant/media`;
- Для HA OS или Home Assistant Docker - `/media`.- Для Home Assistant Core - Путь к ранее созданной папке с медиафайлами.

Кроме того, вы можете выбрать продолжительность записи.

Заполните данные и вызовите сервис, нажав кнопку "ВЫЗВАТЬ СЕРВИС".

## DAPP

Чтобы просмотреть полученное видео, перейдите на [Robonomics DAPP](https://vol4tim.github.io/videostream/).

{% roboWikiPicture {src:"docs/home-assistant/video-dapp.jpg", alt:"video-dapp"} %}{% endroboWikiPicture %}

Вставьте адрес вашего контроллера и нажмите кнопку ниже. Дождитесь завершения процесса "Поиск близнецов".
В результате вы получите IPFS CID со всеми записанными видео.

{% roboWikiPicture {src:"docs/home-assistant/video-ipfs.jpg", alt:"video-ipfs"} %}{% endroboWikiPicture %}

Затем выберите учетную запись контроллера (или любую другую) из выпадающего списка и подпишите сообщение для авторизации в
веб-3 IPFS-шлюзе для загрузки всех видео. В результате вы получите все видео, записанные вашим умным домом.

{% roboWikiPicture {src:"docs/home-assistant/show-videos.jpg", alt:"show-videos"} %}{% endroboWikiPicture %}

Поскольку все видео в папке зашифрованы ключом контроллера, вам нужно его вставить для расшифровки видео.
После этого кнопка воспроизведения видео активируется. Нажмите на нее, чтобы загрузить видео.

{% roboWikiPicture {src:"docs/home-assistant/video-seed.jpg", alt:"video-seed"} %}{% endroboWikiPicture %}