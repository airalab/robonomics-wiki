---
title: Δοκιμαστική σουίτα Substrate Cumulus Parachain για μηνύματα διασυνδεδεμένων αλυσιδωτών

contributors: [ddulesov, boogerwooger, tubleronchik] 
---


Ο βασικός στόχος αυτού του έργου είναι η απλοποίηση της ανάπτυξης χρόνου εκτέλεσης parachain, όταν χρησιμοποιούνται μηνύματα διασυνδεδεμένων αλυσιδωτών. Επιτρέπει την ανάπτυξη κώδικα χρόνου εκτέλεσης με δοκιμές ενσωμάτωσης με υψηλό βαθμό επαναληψιμότητας και απλή χρήση. Αυτοματοποιεί την κατασκευή, τη δημιουργία προκαθορισμένης δικτυακής διαμόρφωσης (δηλαδή 1 αλυσίδα ρελέ + 2 parachains), τη δημιουργία καναλιών μετάδοσης μηνυμάτων μεταξύ των parachains και την εκτέλεση δοκιμών μηνυμάτων, αποστολή μηνυμάτων, χρήση κλήσης στο χρόνο εκτέλεσης, όλα αυτά κατασκευάζονται και συντίθενται σε Python.

Η Δοκιμαστική Σουίτα XCM χρησιμοποιείται για τον έλεγχο του κύκλου παραγωγής της Robobank - το σύνολο των Substrate pallets, τα οποία επιτρέπουν σε ρομπότ να εγγραφούν σε εξωτερικές parachains, να λάβουν προπληρωμένες παραγγελίες, να τις εκτελέσουν και να λάβουν πληρωμές χρησιμοποιώντας εξωτερικά τοκετά. Αυτό επιτρέπει στα ρομπότ να λειτουργούν μέσα στο δίκτυο Robonomics με όλη την απαιτούμενη υποδομή, αλλά ταυτόχρονα να προσφέρουν τις υπηρεσίες τους σε οποιαδήποτε άλλη parachain.

Ένα παράδειγμα βίντεο είναι διαθέσιμο στο [YouTube](https://www.youtube.com/watch?v=S_bZgsxngiM)

Τα βασικά βήματα στο σενάριο επίδειξης είναι:
- εκκίνηση αλυσίδας ρελέ και δύο parachains σε ένα πακέτο 6 διεργασιών
- ρύθμιση καναλιών μηνυμάτων XCM μεταξύ των parachains
- εγγραφή ενός ρομπότ σε και τα δύο parachains
- δημιουργία μιας παραγγελίας για αυτό το ρομπότ στο parachain του πελάτη (κράτηση πληρωμής για την ολοκλήρωση της παραγγελίας)
- αποστολή μηνύματος XCM στο parachain της Robonomics
- δημιουργία της εγγραφής παραγγελίας "καθρέφτη" στο parachain της Robonomics
- το ρομπότ αποδέχεται την παραγγελία στο parachain της Robonomics
- αποστολή μηνύματος XCM για την αποδοχή της παραγγελίας πίσω στο parachain του πελάτη
- αποδοχή της παραγγελίας στο parachain του πελάτη (κράτηση ποινής για έλλειψη ολοκλήρωσης παραγγελίας μέχρι την προθεσμία της παραγγελίας)
- το ρομπότ ολοκληρώνει την παραγγελία στο parachain της Robonomics
- αποστολή μηνύματος XCM για την ολοκλήρωση της παραγγελίας στο parachain του πελάτη
- εξόφληση όλων των πληρωμών (η πληρωμή του πελάτη μεταφέρεται στο ρομπότ, καθώς και η μη χρησιμοποιημένη ποινή)
- κλείσιμο της παραγγελίας

## Πηγαίος κώδικας
Αυτό το έργο είναι ένα fork του
[Προτύπου Κόμβου Κέντρου Ανάπτυξης Substrate](https://github.com/substrate-developer-hub/substrate-node-template).
Περιέχει κώδικα των χρόνων εκτέλεσης που δοκιμάζονται.
Όπως στο αρχικό.Ο κώδικας των parachains βρίσκεται στους καταλόγους "./pallets", "./runtime", "./node".

Διαφορές με το αρχικό "substrate-node-template":
- Αυτός ο runtime του συλλέκτη έχει το module χειριστή HRMP και μπορεί να χειριστεί μηνύματα από αδελφικές parachains
- Έτοιμο mock test runtime για εσωτερικές δοκιμές XCM

## Κατασκευή & Εκτέλεση
Συνιστώμενη ρύθμιση:
```
Ubuntu 20, 16 Gb RAM, 8 CPU, 120 Gb SSD
```
[ΣΗΜΕΙΩΣΗ] Η πρώτη κατασκευή μπορεί να πάρει πολύ χρόνο, έως και μερικές ώρες σε μη βέλτιστες μηχανές.

[ΣΗΜΕΙΩΣΗ] Το σενάριο λειτουργεί με τις ΣΤΑΘΕΡΕΣ εκδόσεις (commit hashes) του Polkadot(Rococo) στην αλυσίδα ρελέ και των parachains.

[ΣΗΜΕΙΩΣΗ] Από προεπιλογή το σενάριο αναδημιουργεί το ίδιο περιβάλλον κάθε φορά που ξεκινά, διαγράφοντας όλες τις προηγούμενες καταστάσεις. Αυτή η συμπεριφορά μπορεί να αλλάξει στο "config.sh" χρησιμοποιώντας την παράμετρο "PERSISTENT".

Εκτέλεση του σεναρίου κατασκευής και ρύθμισης.  
```bash
git clone https://github.com/airalab/xcm-robobank-prototype.git
cd xcm-robobank-prototype
./scripts/init.sh
```

Βασικές ενέργειες του σεναρίου "init.sh":
 - ανάγνωση ρυθμίσεων (αρχείο "config.sh" με αριθμό αναθεώρησης, αρχικά κλειδιά κόμβου και αναγνωριστικά, παράμετρος διατήρησης chaindata, κλπ.)
 - εγκατάσταση πακέτων λειτουργικού συστήματος, Rust και Python
 - δημιουργία ξεχωριστών δυαδικών για την αλυσίδα ρελέ και επίσης για τις δύο parachains
    - τα δυαδικά θα δημιουργηθούν στον υποκατάλογο ./bin. 
 - (προαιρετικό) διαγραφή όλων των προηγούμενων δεδομένων αλυσίδας για όλες τις αλυσίδες
    - απενεργοποιείται εάν η "PERSISTENT=1" έχει οριστεί στο "config.sh"
 - εκτέλεση ως ξεχωριστές διεργασίες (με ξεχωριστά PIDs και σωλήνες I/O):
    - επικυρωτές της αλυσίδας ρελέ (δηλαδή 4 επικυρωτές που εκτελούν μια σταθερή αναθεώρηση Rococo)
    - συλλέκτες για την parachain-100 (δηλαδή ένας συλλέκτης για την πρώτη parachain που αναπτύσσετε)
    - συλλέκτες για την parachain-200 (δηλαδή ένας συλλέκτης για τη δεύτερη parachain που αναπτύσσετε)
 - εκτύπωση όλων των σημείων πρόσβασης, θυρών στην κονσόλα, επιτρέποντάς σας να μελετήσετε οποιαδήποτε αλυσίδα χρησιμοποιώντας εφαρμογές frontend (εξερευνητή, DApp)
 - συνεχίζει να εκτυπώνει όλα τα δεδομένα εξόδου όλων των αλυσίδων στην κονσόλα

[ΠΡΟΕΙΔΟΠΟΙΗΣΗ] Μετά την εκκίνηση, περιμένετε μέχρι να είναι ενεργό το δίκτυο, βεβαιωθείτε ότι η ολοκλήρωση των μπλοκ έχει ξεκινήσει και ότι οι parachains είναι εγγεγραμμένες. Αυτές οι διαδικασίες πρέπει ναΑπαιτεί περίπου 5 λεπτά (50 blocks x 6 δευτερόλεπτα).

## Έλεγχος ότι το αρχικό στήσιμο λειτουργεί

Χρησιμοποιήστε το προεπιλεγμένο μπροστινό μέρος του Polkdot και τα σημεία άκρων "--ws-port" που δημιουργήθηκαν για να συνδεθείτε με κάθε κόμβο.
Ανοίξτε την [εφαρμογή Polkadot](https://polkadot.js.org/apps/?rpc=ws://localhost:9500/) για να παρακολουθήσετε τις αλυσίδες.

### Παράδειγμα:
Τοπικός υπολογιστής, 4 επαληθευτές αλυσίδας αναμετάδοσης, ένας συλλέκτης parachain-100, ένας συλλέκτης parachain-200:
- [Επαληθέυτης αναμετάδοσης 1](https://polkadot.js.org/apps/?rpc=ws://localhost:9500/)
- [Επαληθέυτης αναμετάδοσης 2](https://polkadot.js.org/apps/?rpc=ws://localhost:9501/)
- [Επαληθέυτης αναμετάδοσης 3](https://polkadot.js.org/apps/?rpc=ws://localhost:9502/)
- [Επαληθέυτης αναμετάδοσης 4](https://polkadot.js.org/apps/?rpc=ws://localhost:9503/)
- [Συλλέκτης Parachain-100](https://polkadot.js.org/apps/?rpc=ws://localhost:10054/)
- [Συλλέκτης Parachain-200](https://polkadot.js.org/apps/?rpc=ws://localhost:10055/)

Αν όλα λειτουργούν και η συναίνεση ξεκίνησε, μπορούμε να προχωρήσουμε στην εκτέλεση των δοκιμαστικών μας περιπτώσεων (σε ένα νέο τερματικό).

### Δοκιμή μετάδοσης μηνυμάτων UMP
```bash
./scripts/init.sh ump
```
Δημιουργεί ένα μήνυμα `Balance.transfer` στο `parachain-100` και το περνά στην αλυσίδα αναμετάδοσης.
Όταν η αλυσίδα αναμετάδοσης λάβει το μήνυμα, θα μεταφέρει 15 τοκενς από τον λογαριασμό `para 100` στον λογαριασμό Charlie.

### Δοκιμή μετάδοσης μηνυμάτων HRMP
```bash
./scripts/init.sh ump
```

Δημιουργεί ένα μήνυμα `Balance.transfer` στο `parachain-100` και το περνά στον `αδελφό 200`.
Πριν από αυτό, εξοπλίζει τον λογαριασμό `subl 100` με 1000 τοκενς και καθιερώνει ένα κανάλι επικοινωνίας μεταξύ των parachains.
```bash
./scripts/init.sh hrmp
```
Τα επόμενα μηνύματα μπορούν να σταλούν εκτελώντας την υποεντολή `hrmpm`. Δεν δημιουργεί ένα κανάλι και έτσι λειτουργεί πιο γρήγορα.
```bash
./scripts/init.sh hrmpm
```

### Περισσότερες επιλογές
```bash
./scripts/init.sh help
```

## Τοπικό Δίκτυο Ελέγχου### Δημιουργία προσαρμοσμένου chain spec
```
./bin/polkadot build-spec --chain rococo-local --disable-default-bootnode > rococo_local.json
```

Επεξεργασία του αρχείου rococo_local.json, αντικαταστήστε τις παραμέτρους των υπολοίπων και των αρχών με τις δικές σας.
```json
  "keys": [
    [
      "",
      "",
      {
        "grandpa": "",
        "babe": "",
        "im_online": "",
        "para_validator": "",
        "para_assignment": "",
        "authority_discovery": ""
      }
    ]
```

Διεύθυνση Polkadot για το //Alice//stash (κρυπτογραφία sr25519).
```bash
$ polkadot key inspect-key --scheme sr25519 --network substrate //Alice//stash
```

```text
Μυστικό κλειδί URI `//Alice//stash` είναι ο λογαριασμός:
Μυστικό seed:      

Δημόσιο κλειδί (hex): 

Αναγνωριστικό λογαριασμού:       

Διεύθυνση SS58:     
```

Κλειδί συνεδρίας grandpa του Polkadot για το //Alice (κρυπτογραφία ed25519).
```bash
$ polkadot key inspect-key --scheme ed25519 --network substrate //Alice
```
```text
Μυστικό κλειδί URI `//Alice` είναι ο λογαριασμός:
Μυστικό seed:      

Δημόσιο κλειδί (hex): 

Αναγνωριστικό λογαριασμού:       

Διεύθυνση SS58:     
```

Διεύθυνση Polkadot για το //Alice (κρυπτογραφία sr25519).
```
$ polkadot key inspect-key --scheme sr25519 --network substrate //Alice
```
```text
Μυστικό κλειδί URI `//Alice` είναι ο λογαριασμός:
Μυστικό seed:      

Δημόσιο κλειδί (hex): 

Αναγνωριστικό λογαριασμού:       

Διεύθυνση SS58:     
```

Μετατροπή του αρχείου rococo_local.json στη μορφή raw.
```
./bin/polkadot build-spec --chain rococo_local.json --raw --disable-default-bootnode > rococo_local.json
```
Για να χρησιμοποιήσετε το νέο chain spec αντικαταστήστε το αρχείο rococo.json στον φάκελο ./config/ με το νέο και επανεκκινήστε το chain.
```bash
./scripts/init.sh run
```
Μπορείτε ελεύθερα να επεξεργαστείτε τον κώδικα. Η παραπάνω εντολή θα ανακατασκευάσει το έργο και θα ενημερώσει τον κόμβο συλλέκτη πριν ξεκινήσει.
Το Cumulus είναι λογισμικό προεκδοχής που εξακολουθεί να βρίσκεται υπό έντονη ανάπτυξη.
Χρησιμοποιούμε ένα συγκεκριμένο commit του polkadot [46c826f595021475fa5dbcd0987ed53f104e6e15  18 mar 2021](https://github.com/paritytech/polkadot/tree/46c826f595021475fa5dbcd0987ed53f104e6e15)

Μπορείτε να χρησιμοποιήσετε πιο πρόσφατες εκδόσεις του λογισμικού. Για να το κάνετε αυτό, αλλάξτε το  POLKADOT_COMMIT  στο ./scipt/config.sh
στην τελευταία δέσμευση του κλαδιού `rococo-v1`, διαγράψτε το ./bin/polkadot, και εκτελέστε 
```bash
./scripts/init.sh run
```

Ενημερώστε τις εξαρτήσεις του έργου συλλέκτη
```bash
cargo update
./scripts/init.sh build
```
Κάποιες εξαρτήσεις πιθανότατα απαιτούν νέα χαρακτηριστικά εργαλείων rust. Αυτό το έργο βασίζεται στο rust `nightly-2021-01-26`
Ενημερώστε την έκδοση του εργαλείου rust στο ./scripts/config.sh πριν την κατασκευή.

## Χάκαρε την παρακαταχώρηση
[Προσθήκη εξωτερικού παζλ](https://substrate.dev/docs/en/tutorials/add-a-pallet/) - ίσως θα έπρεπε να είναι στο "μάθετε περισσότερα"?
## Μάθετε Περισσότερα

Ανατρέξτε στο ρεύμα
[Πρότυπο Κόμβου Ανάπτυξης Substrate](https://github.com/substrate-developer-hub/substrate-node-template)
για να μάθετε περισσότερα σχετικά με τη δομή αυτού του έργου, τις δυνατότητες που ενσωματώνει και τον τρόπο με τον
οποίο αυτές οι δυνατότητες υλοποιούνται. Μπορείτε να μάθετε περισσότερα για
[Το Μονοπάτι του Μπλοκ Παρακαταχώρησης](https://polkadot.network/the-path-of-a-parachain-block/) στο
επίσημο ιστολόγιο του Polkadot.
[Εργαστήριο Parity Cumulus](https://substrate.dev/cumulus-workshop/#/)